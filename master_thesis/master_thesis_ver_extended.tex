\documentclass[a4j,11pt]{jarticle}
\bibliographystyle{jplain}

\def\proposed{DNRBA}
\def\proposedJ{適応的個体間距離に基づく複数解探索型Bat Algorithm}

\usepackage[dvipdfmx]{graphicx}
\usepackage{otf}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{algorithmic}
\usepackage{algorithm}
\usepackage{./ref/placeins}
\usepackage{here}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{fancyhdr}
\usepackage{comment}
\usepackage{afterpage}
\renewcommand\thefootnote{\arabic{footnote}}
\renewcommand{\algorithmicforall}{\textbf{for each}}
\newcommand{\argmax}{\mathop{\rm arg~max}\limits}
\newcommand{\argmin}{\mathop{\rm arg~min}\limits}

\makeatletter
\def\maketitle{%
\null
\begin{center}\leavevmode
\normalfont
{\LARGE \@title\par}%
\vfill
{\Large \@author\par}%
\vskip 1cm
{\Large \@date\par}%
\end{center} %
\cleardoublepage
}
\makeatother


\title{{\Large 平成30年度 電気通信大学大学院情報理工学研究科 修士論文\\\ \\}適応的個体間距離に基づく複数解探索型Bat Algorithm}
\author{
\begin{tabular}{cc}
所属&情報学専攻メディア情報学プログラム\\
学籍番号&1730022 \\
氏名&岩瀬拓哉 \\
主任指導教員&\UTF{9AD9}玉圭樹教授\\
指導教員&佐藤寛之准教授\\
提出日&平成31年1月28日
\end{tabular}
}

\date{}
% 提出時はこれをコメントアウトする
%\date{更新日: \today}
\begin{document}
\thispagestyle{empty}
\maketitle

\newpage
\pagenumbering{roman}
\pagestyle{plain}
\setcounter{page}{1}
\section*{概要}

本論文では,複数の多峰性を持つ関数最適化に着目し，最適解と局所解を含む解を可能な限り多く見出す多点探索アルゴリズムを考案するとともに，その有効性を検証することを目的とする．特に，従来の多点探索アルゴリズムは一つの最適解をより早くかつ正確に見出すアプローチが主流であるが，解が１つではなく複数存在する実問題では，一つの最適解だけでなく複数解(最適解及び局所解)を探索することは，有力な解候補を複数持つという意味で重要である．このような複数解探索に基づく手法として，局所解への収束を防ぐ機構であるNiching scheme と遺伝的アルゴリズムに代表される進化計算を組み合わせた Niching method が探究されているが，いずれの手法においても密接した解を除き，探索空間内にランダムに解生成するため，乱数に強く依存するという問題がある．この問題を解決するために，本研究では多点探索アルゴリズムの中でも大域探索と局所探索のバランスを調整可能なBat Algortihm を採用し，個体間距離に基づく動的変化を考慮したNiching scheme を用いることで，最適解だけでなく局所解も同時に探索可能な 3 つの複数解探索手法を提案する．具体的には，(i) 未探索領域へ解の探索を促すNovelty Searchを導入したNovelty Search-based Bat Algorithm (NSBA)，(ii) 探索空間の大きさと最適解数から算出される Niche Radius を用いることで，予め各個体の探索領域を決定し，その探索領域内の最良個体から遠ざかる方向に移動させることによって，個体同士を同じ解に留まらせないNiche Radius-based Bat Algorithm (NRBA)，(iii) 探索領域を動的に変更することで，NRBAの効果を高めたBat Algorithm with Dynamic Niche Radius (DNRBA)を考案し，最適解と局所解の数が異なる多峰性関数を用いて比較する．その結果，(1)従来手法の BA は一つの最適解に収束するのに対し，３つの提案手法は最適解及び局所解を探索することができ，(2)その中でもDNRBA，NRBA，NSBAの順で性能が良いことが明らかになった．


\newpage
\tableofcontents

\newpage
\setcounter{page}{1}
\pagenumbering{arabic}
\pagestyle{fancy}
\cfoot{\thepage}
\chead{}
\lhead{}
\rhead{{\small \leftmark\ \ \ \ $-$\ \ \ \ \rightmark}}

\section{はじめに}
\subsection{背景と目的}
実問題の複雑さを多峰性最適化問題として表した時に一つの最適解だけでなく，複数の局所解を探索することは，環境変化によって解が変化した場合や複数の選択の候補解として保持しておくことは非常に重要な意味を持つ．実問題の一例として，「探査機の月面着陸地点選定問題」\cite{ECCompetition} では一つの最適解と複数の局所解が存在するが，最適解
が着陸困難な場所であった場合，他の着陸地点(則ち局所解)を選択肢として保持しておくことで補うことが可能となる．複数解探索手法({\it Niching methods}) \cite{dADE}, \cite{nea}, \cite{CDE} は，進化的アルゴリズム(Evolutionary Algorithms:EAs) \cite{GA} や多点探索アルゴリズム \cite{CMA-ES}, \cite{PSO}, \cite{DE}, \cite{BA} をベースとしたNiching schemeを組み合わせた手法として数多く研究がなされている．
しかし，複数解探索する上でいずれの手法も探索する個体が同じ局所解に留まらないための機構が組み込まれているだけであり，未探索領域への探索はランダム性に依存する傾向にある．

そこで本研究では，次の3つの複数解探索手法を提案する．(i)未探索領域を探索可能なNovelty Searchを用い，探索範囲の自動調整が可能なBat Algorithmを組み合わせたNovelty Search-based Bat Algorithm (NSBA) \cite{NSBA}; (ii)探索空間の大きさと最適解数から算出されるNiche Radiusを用いることで，予め各個体の探索領域を決定し，その探索領域内の最良個体から遠ざかる方向へ移動し，個体同士が同じ解に留まらず，分散させるNiche Radius-based Bat Algorithm (NRBA) \cite{NRBA}; (iii)個体の分布密度が高いNiche Radius内で，評価値の低い個体をその領域から移動させるNRBAを拡張したBat Algorithm with Dynamic Niche Radius (DNRBA)．これら3つの提案手法の探索性能の有効性を検証するため，従来手法と各提案手法を比較する．使用する評価関数は，最適解と局所解の両方を含む関数，最適解のみ存在する関数の2つを用意し，探索性能に差異があるか調査する．

% 実験の結果，提案手法の一つであるNSBAは最も探索性能が悪かったが，NRBA，次いでDNRBAは他の手法とほぼ同等の探索性能を示すことが可能であった．複雑な多峰性を持つ関数においてはDNRBAの方が探索性能が高いが，一般的にはNRBAのほうが探索性能が高かった．これは，局所解へ陥ってしまった個体を最適解へ移動させる機構を持つDynamic Niche Radiusが複雑な関数においては有効だが，容易な問題に対しては局所解へ陥ることがないため，NRBAの方が有効であったと考えられる．

\subsection{関連研究}

複数解探索問題に取り組んでいる{\it Niching methods}の研究例として，Thomsenは差分進化(Differential Evolution:DE) \cite{DE} をベースとして，最近傍個体同士を評価させるCrowding \cite{Crowding} を組み合わせたCDE \cite{CDE} を提案した．EpitropakisらはDEに対し，未探索領域に新しく個体を生成させるため，環境に応じて動的に変化させるパラメータを導入したDynamic Archive Niching Differential Evolution (dADE)　\cite{dADE} を提案した．


\newpage
\subsection{論文構成}
本論文の構成は次の通りである.
\ref{sec:MA}章で多峰性最適化問題における，複数解探索手法のベースとなる一般的なEAsと多点探索アルゴリズムについて説明し，\ref{sec:ns}章でその複数解探索へ向けた機構であるNiching Schemeについて説明する．\ref{sec:nm}章では，EAsあるいは多点探索アルゴリズムとNiching Schemeを組み合わせた複数解探索手法を説明し，\ref{sec:MOP}章で実験で扱う最小化問題における複数解(最適解と局所解を含む)評価関数と，他の最先端手法との性能比較で扱う最大化問題における複数解探索(最適解のみ)を目的とした評価関数について説明する．\ref{sec:NSBA}章から\ref{sec:DNRBA}章までは提案手法であるNSBA, NRBA及びDNRBAの説明及び性能比較をした後，\ref{sec:experiment}章にて他の最先端手法との比較実験を行い，\ref{sec:END}章で本論文のまとめを行う．

\newpage
\section{Metaheuristic Algorithms}

% \subsection{Evolutionary Algorithms (EAs)}
\label{sec:MA}

現実問題の複雑さを多峰性関数として表現した問題を最適化するためにEAsをはじめとした手法が用いられるようになった．EAsのメカニズムとして単一の最適解を探索することを目的として設計されており，生物の生殖や突然変異，交叉，適者生存といった過程をモデルとしている．近年ではNiching methods のベースとして多点探索アルゴリズムを組み合わせた手法 \cite{dADE}, \cite{nea}, \cite{CDE},が提案されている．本研究では，その多点探索アルゴリズムの中でも大域と局所探索を考慮したBAに着目し，局所解を保持することのできるNiching schemeを組み合わせることで複数解探索可能な手法を提案する．本章では，EAsと多点探索アルゴリズムの代表的な手法を\ref{ss:EAs}節，\ref{ss:swarm}節で紹介する．

\subsection{進化的アルゴリズム (EAs)}
\label{ss:EAs}
生物の進化をモデルとした最適解探索手法であり，進化の過程で個体がより評価値の良い個体となることのできるアルゴリズムである．

\subsubsection{遺伝的アルゴリズム (GA)}
\label{sss:GA}
遺伝的アルゴリズム(Genetic Algorithm:GA) \cite{GA} は生物の進化の過程を模擬したアルゴリズムであり，最適化問題において最も基本的なヒューリスティック手法である．生物は次の世代により良い遺伝子を持った個体を残すため，まずは親集合の中から個体を選択し，選択した個体同士を交叉させる．この時，ある一定の確率で突然変異させる．次に，交叉させて新たに生成された個体を子集合の解候補とし，親と子の個体を評価して，評価値の高い個体は次世代の個体として保存され，評価値の低い個体は淘汰される．各個体に対し，この「選択」，「交叉」，「突然変異」，「評価(淘汰)」を繰り返すことで，環境に対する適合度が高くなっていく(評価値の高い遺伝子が残る)．アルゴリズムの疑似コードはAlgorithm \ref{code:ga}に，その手順は以下に記す．

\begin{itemize}
\item {\bf STEP1: 個体の初期化(1-2行目)} \\
$N$個の個体$x_i$を初期集合として生成し，ランダムな評価値を割り当てる．また交叉率と突然変異率を定義する．
\item {\bf STEP2: 選択と交叉(5-7行目)} \\
選択した親同士$x_i$を交叉率$P_c$により交叉させ，子(解候補) $x_i^{new}$を生成する．
\item {\bf STEP3: 突然変異(8-10行目)} \\
突然変異率$P_m$により，子(解候補)の評価値を変化させる．
\item {\bf STEP4: 評価(11-13行目)} \\
親個体$x_i$と子個体$x_i^{new}$の評価値を比較し，評価値の高い個体を次世代に残す．
\end{itemize}

\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}

\begin{algorithm}[H]
\caption{Genetic Algorithm}
\label{code:ga}
\begin{algorithmic}[1]
\REQUIRE Objective Function $F(x), x=(x_1,x_2,...,x_d)$
\STATE Initialize Population $x_i (i=1,2,...,N)$
\STATE Initialize $P_m, P_c$
\WHILE{t $<$ Max Generation}
\FOR{i=1 to N}
\IF{$rand(0,1) < P_c$}
\STATE Generate an offspring $x_i^{new}$ 
\ENDIF
\IF{$rand(0,1) < P_m$}
\STATE Replace mutated offspring $x_i^{new}$
\ENDIF
\IF{$F(x_i)<F(x_i^{new})$}
\STATE Replace $x_i$ with $x_i^{new}$
\ENDIF
\ENDFOR
\STATE t=t+1
\ENDWHILE
\end{algorithmic}
\end{algorithm}

 \subsubsection{進化戦略 (ES)}
 進化戦略 (Evolutionary Strategy:ES) は
 \label{sss:ES}



\subsubsection{A Fast and Elitist Multi-objective Genetic Algorithm (NSGA-II)}
\label{sss:nsga}
NSGA-II \cite{NSGAII} は，複数の目的関数を同時に満たす解を探索する手法として一般的に用いられる代表的な手法の一つである．アルゴリズムの手順及び疑似コードを以下に記す．

\begin{itemize}
\item {\bf STEP1: 個体の初期化 (1行目)} \\
初期集合$Q_i^0 (i=1,2,...,N)$の生成と次世代集合$P^t=\emptyset$を用意する．
\item {\bf STEP2: 非優越ソート (3-4行目)}\\
$R^t=Q^t \cup P^t$を作成し，$R^t$の個体をランク付けし，$\mathcal{F}_i (i=1,2,...,N)$に分類する．その後，新たに$P^{t+1}=\emptyset$を作成し，$i=1$とする．
\item {\bf STEP3: 混雑距離計算 (6-10行目)}\\
$|P^{t+1}+|\mathcal{F}^i||\leq N$を満たすまで$P^{t+1}$に$\mathcal{F}$を追加し，混雑度ソートを行う．混雑度ソートは，$i$番目の個体に対する個体密集度に基づいて算出される．混雑度計算は次式で表される．
\begin{equation}
\label{eq:nsga-crowd}
d_j = \sum_{m=1}^M \frac{f_m^{I^{m}_{j+1}}-f_m^{I^{m}_{j-1}}}{f_m^{max}-f_m^{min}}
\end{equation}
この時，$M$は目的関数の数を表し，$I_m$は$m$番目の目的関数においてソートされた$j$番目の個体を意味し，それ以外の全ての個体を$j=2,...,l-1$とする．
\item {\bf STEP4: 混雑度によるトーナメント選択 (11-13行目)}\\
混雑度トーナメント選択は次の2つの基準によって評価する個体を選択する．
\begin{itemize}
  \item 個体の非優越ランク: $i_{rank}$
  \item 個体の混雑距離: $i_{distance}$
\end{itemize}
\end{itemize}

\begin{algorithm}[H]
\caption{Elitist Non-Dominated Sorting Genetic Algorithm (NSGA-II)}
\label{code:nsga}
\begin{algorithmic}[3]
\REQUIRE Initialize Population $x_i (i=1, 2,..., N)$, $p_c$, $p_m$, $\eta_c$ and $\eta_m$
\STATE set $t \leftarrow 0$, $Q_0=$select-cross-mutate $P^0$
\WHILE{$t < $ MaxIteration}
\STATE $R^t=P^t \cup Q^t$
\STATE $\mathcal{F} = {\rm nondominated-sort}(R^t)$
\STATE $P^{t+1}=\emptyset$ and $i \leftarrow 1$
\WHILE{$|P^{t+1}+|\mathcal{F}^i||\leq N$}
\STATE corwding-distance($\mathcal{F}$)
\STATE $P^{t+1}=P^{t+1} \cup \mathcal{F}^i$
\STATE $i \leftarrow i+1$
\ENDWHILE
\STATE Sort($\mathcal{F}^i \prec c$)
\STATE $P^{t+1}=P^{t+1} \cup \mathcal{F}^i[1:(N-|P^{t+1}|)]$
\STATE $Q^{t+1}=$select-cross-mutate ($P^{t+1}$)
\STATE $t \leftarrow t+1$
\ENDWHILE 
\end{algorithmic}
\end{algorithm}

\subsection{多点探索アルゴリズム}
\label{ss:swarm}
EAsは単一の個体が進化の過程により，評価値の良い個体になることが可能であるが，局所性が強いため，最適解ではなく局所解へ収束してしまうことがある．そこで，大域探索を得意とした，複数の個体を用いた探索手法が登場した．これらの手法は複数の個体間で情報を共有することで，効率的な探索を図ることができる．その代表的な手法を次節より紹介する．

\subsubsection{粒子群最適化 (PSO)}
\label{sss:PSO}
% 数式番号に章番号を追加
  % \makeatletter
  % \renewcommand{\theequation}{\arabic{section}-\arabic{subsection}-\arabic{equation}}
  % \@addtoreset{equation}{subsection}
  % \makeatother

  \makeatletter
    \renewcommand{\theequation}{%
    \thesection.\arabic{equation}}
    \@addtoreset{equation}{section}
  \makeatother
% 図に章番号追加
  \makeatletter
    \renewcommand{\thefigure}{%
    \thesection.\arabic{figure}}
    \@addtoreset{figure}{section}
  \makeatother

最適化手法の一つとして粒子群最適化(Particle Swarm Optimization:PSO)がある．PSOは，ランダムに個体を初期化するという点において，遺伝的アルゴリズム(GA)に似た性質を持つ．魚や鳥の群れの動きをモデルにしたアルゴリズムであり，個体間のユークリッド距離を速度として新たに解候補を生成する．個体の速度及び生成式は以下の通りである．
\begin{equation}
\label{eq:pso-vi}
\mbox{\boldmath $v_i^{t+1}$}=w\mbox{\boldmath $v_i^t$}+c_1r_1 \cdot (\mbox{\boldmath $x_{pbest}^t$}-\mbox{\boldmath $x_j^t$})+c_2r_2 \cdot (\mbox{\boldmath $x_{gbest}^t$}-\mbox{\boldmath $x_i^t$})
\end{equation}
\begin{equation}
\label{eq:pso-xi}
\mbox{\boldmath $x_i^{t+1}$}=\mbox{\boldmath $x_i^t$}+\mbox{\boldmath $v_i^{t+1}$}
\end{equation}
$x_i$，$v_i$は時刻$t$における各個体の現在位置と速度を表し，$w,c_1,c_2$は係数，$r_1, r_2$は一様乱数を表す．これらの係数が速度を制限するパラメータとなっており，$w$が時刻$t$での速度を調整し，$c_1,c_2$は値が1より小さいほど局所探索を行い，1より大きくなると最良個体を含む広い範囲を大域探索するようになる．
PSOのアルゴリズムの疑似コードをAlgorithm \ref{code:pso}に，その手順を以下に記す．

\begin{itemize}
\item {\bf STEP1: 初期個体の生成 (1-3行目)}\\
個体$x_i (i=1,2,...,N)$を探索空間内にランダム生成し，係数$c_1,c_2, w$を初期化する．
\item {\bf STEP2: 解候補の生成と速度の更新 (6行目)}\\
速度$v_i$により新たに解候補$x_i^{t+1}$を生成を生成する．
\item {\bf STEP3: 評価 (7-12行目)}\\
生成した解候補が$t$時点での最良解$x_{pbest}$よりも評価値が高ければ更新する．
\item {\bf STEP4: STEP2へ戻る}\\
終了条件を満たすまでSTEP2へ戻る
\end{itemize}

\begin{algorithm}[H]
\caption{Particle Swarm Optimization}
\label{code:pso}
\begin{algorithmic}[2]
\REQUIRE Objective Function $F(x), x=(x_1,x_2,...,x_d)$
\STATE Initialize Population $x_i (i=1,2,...,N)$ and Velocity $v_i$
\STATE $F(x_{gbest})=\max{F(x_i)}$
\STATE Initialize $c_1,c_2,w$
\WHILE{t $<$ Max Iteration}
\FOR{i=1 to N}
\STATE Generate a new solution $x_i^{t+1}$ and update $v_i$ [Eqs.(\ref{eq:pso-vi}),(\ref{eq:pso-xi})]
\IF{$F(x_i^{t+1})>F(x_{pbest})$}
\STATE Replace the individual $x_i^{t+1}$ as $x_{pbest}$
\ENDIF
\IF{$F(x_{gbest})<F(x_{pbest})$}
\STATE $x_{gbest}=x_{pbest}$
\ENDIF
\ENDFOR
\STATE t=t+1
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\subsubsection{差分進化 (DE)}
\label{sss:DE}

% 数式番号に章番号を追加
%   \makeatletter
%   \renewcommand{\theequation}{\arabic{section}-\arabic{subsection}-\arabic{equation}}
%   \@addtoreset{equation}{subsection}
%   \makeatother

差分進化(Differential Evolution:DE) \cite{DE} は進化的計算手法の一つであり，問題に応じて個体間同士の相対距離に基づいた探索戦略を用いることのできる，他のアルゴリズムとは異なる特徴を持つ．DEは以下の手順により探索を繰り返す．
\begin{itemize}
\item {\bf STEP1: 個体の初期化 (2-3行目)} \\
探索領域内にランダムで個体を生成する．
\item {\bf STEP2: 突然変異による解候補の生成 (5-6行目)} \\
DEは以下，いずれかの探索戦略を用いて解候補を生成する．
\begin{enumerate}
\item{DE/rand/1}
\begin{equation}
\label{eq:rand1}
\mbox{\boldmath $v_{i,j}^{t+1}$}=\mbox{\boldmath $x_{r1,j}^t$}+F \cdot (\mbox{\boldmath $x_{r2,j}^t$}-\mbox{\boldmath $x_{r3,j}^t$})
\end{equation}
\item{DE/best/1}
\begin{equation}
\label{eq:best1}
\mbox{\boldmath $v_{i,j}^{t+1}$}=\mbox{\boldmath $x_{gbest,j}^t$}+F \cdot (\mbox{\boldmath $x_{r1,j}^t$}-\mbox{\boldmath $x_{r2,j}^t$})
\end{equation}
\item{DE/current-to-best/1}
\begin{equation}
\label{eq:cur2best1}
\mbox{\boldmath $v_{i,j}^{t+1}$}=\mbox{\boldmath $x_{i,j}^t$}+F \cdot (\mbox{\boldmath $x_{gbest,j}^t$}-\mbox{\boldmath $x_{i,j}^t$})+F \cdot (\mbox{\boldmath $x_{r1,j}^t$}-\mbox{\boldmath $x_{r2,j}^t$})
\end{equation}
\item{DE/rand/2}
\begin{equation}
\label{eq:rand2}
\mbox{\boldmath $v_{i,j}^{t+1}$}=\mbox{\boldmath $x_{r1,j}^t$}+F \cdot (\mbox{\boldmath $x_{r2,j}^t$}-\mbox{\boldmath $x_{r3,j}^t$})+F\cdot (\mbox{\boldmath $x_{r4,j}^t$}-\mbox{\boldmath $x_{r5,j}^t$})
\end{equation}
\item{DE/best/2}
\begin{equation}
\label{eq:best2}
\mbox{\boldmath $v_{i,j}^{t+1}$}=\mbox{\boldmath $x_{gbest,j}^t$}+F \cdot (\mbox{\boldmath $x_{r1,j}^t$}-\mbox{\boldmath $x_{r2,j}^t$})+F \cdot (\mbox{\boldmath $x_{r3,j}^t$}-\mbox{\boldmath $x_{r4,j}^t$})
\end{equation}
\end{enumerate}
この時，$i,j$は個体番号と次元数を表し，$r_1,...,r_4$は1から$N$までの一様乱数の整数を表す．スケール因子$F$は解候補を生成するためのベクトルを制御するための変数で，0から1までの乱数で表される．
「DE/rand/1」は，個体の親集団の中から3つの個体をランダムに選択し，その相対距離を用いて新たに解候補$v_{i,j}^{t+1}$を生成する．「DE/best/1」は，個体の親集団の中の最良個体と個体を2つランダムに選択し，その最良個体付近に新しい解候補$v_{i,j}^{t+1}$を生成する．「DE/current-to-best/1」は，ランダムに選択した2つの個体と，最良個体と個体自身の相対距離と用い，最良個体方向へ新たに解候補$v_{i,j}^{t+1}$を生成する．「DE/rand/2」では，親集合から5つの個体をランダムに選択し，式(\ref{eq:rand1})よりも広い探索領域内に新しく解候補$v_{i,j}^{t+1}$を生成する．「DE/best/2」も同様，式(\ref{eq:best1})よりも広い探索領域内に新しく解候補$v_{i,j}^{t+1}$を生成する．

\item {\bf STEP3: 交叉 (7-13行目)} \\
解に多様性を持たせるため，ここではSTEP2で生成した解候補$v_{i,j}^{t+1}$と個体$x_i$を確率的に交叉させ，新たに解$u_{i,j}^{t+1}$を生成する．生成式は次式の通りである．
\begin{equation}
\mbox{\boldmath $u_{i,j}^{t+1}$}=\begin{cases}
\mbox{\boldmath $v_{i,j}^{t+1}$} & {\rm if}(rand(0,1) \leq C_r) \ or \ j=D \\
\mbox{\boldmath $x_{i,j}^{t+1}$} & {\rm if}(rand(0,1) > C_r) \ and \ j \neq D
\end{cases}
\end{equation}
ここで$C_r$は$[0,1]$の範囲内での交叉係数を表す．この交叉係数$C_r$が一様乱数以上であればSTEP2で生成した解候補$v_{i,j}^{t+1}$が採用され，一様乱数未満であれば個体$x_{i,j}$が採用される．

\item {\bf STEP4: 評価 (14-16行目)} \\
最良個体と生成した解$u_{i,j}^{t+1}$を比較し，評価値の高い方を次世代に引き継ぐ．

\item {\bf STEP5: 終了条件を満たすまでSTEP2へ戻る}
\end{itemize}

ここでは，一般的に用いられるDE/rand/1のアルゴリズムの疑似コードを以下のAlgorithm \ref{code:de}に記す．

\begin{algorithm}[H]
\caption{Differential Evolution (DE/rand/1)}
\label{code:de}
\begin{algorithmic}[3]
\REQUIRE Objective Function $f(x), x=(x_1,x_2,...,x_d)$
\STATE Initialize Population $x_i (i=1,2,...,N)$ 
\STATE Define crossover probability $C_r,$ and scaling factor $F$

\WHILE{t $<$ Max Iteration}
\FOR{i=1 to N}
\STATE Select random integer $r_1, r_2 \in \{ 1,2,..., N| r_1 \neq r_2 \neq i\}$
\STATE Generate a candidate $v_{i,j}$  [Eq. (\ref{eq:rand1})]
\FOR{$j=1$ to $D$}
\IF{$rand(0, 1) \leq C_r \ or \ j=D$}
\STATE offspring $u_{i,j} = v_{i,j}^{t+1}$
\ELSE[$rand(0,1) > C_r \ and \ j \neq D$]
\STATE offspring $u_{i,j} = x_{i,j}^t$
\ENDIF
\ENDFOR
\IF{$f(u_{i,j}^{t+1})>f(x_{pbest})$}
\STATE Replace the offspring $u_{i,j}^{t+1}$ as $x_{pbest}$
\ENDIF
\ENDFOR
\STATE t=t+1
\ENDWHILE
\end{algorithmic}
\end{algorithm}


\subsubsection{Bat Algorithm (BA)}
\label{sss:BA}

% 数式番号に章番号を追加
  % \makeatletter
  % \renewcommand{\theequation}{\arabic{section}-\arabic{subsection}-\arabic{equation}}
  % \@addtoreset{equation}{subsection}
  % \makeatother

Bat Algorithm(BA) \cite{BA}は群知能アルゴリズムの一つで，対象物までの方向や距離を知るコウモリの特性（エコロケーション）を利用して周囲の状況を認知し，大域探索と局所探索が進むにつれて探索速度を徐々に落とし，探索性能を自動調節することが可能なアルゴリズムである．
% ．BAにおいて，コウモリは自らの発する超音波の周波数を持ち，その周波数を調整するためのパラメータとしてラウドネス${A}$を用いる．
各個体の周波数${f_i}$，速度${v_i}$，位置${x_i}$は以下の式で定義し，更新される．
ラウドネス${A}$は，コウモリが対象物に近づくと値が減少し，移動距離も比例して短くなる．
コウモリの行動は以下３つで構成される．
\begin{itemize}
\item 大域探索: 各コウモリは位置${x_i}$において，自身が発する周波数${f_i}$の反響によって対象物との距離を測り，対象物に向かって速度${v_i}$で移動する．
\item 局所探索: 対象物近辺にコウモリを移動させる．
\item ランダム探索: 探索領域内にコウモリをランダムで移動させる．
\end{itemize}

BAで扱う各個体の周波数$f_i$，速度$v_i$，位置$x_i$は以下の式で定義される．
\begin{equation}
f_{i} =f_{min}+(f_{max}-f_{min}) \beta
\label{eq:freq} 
\end{equation}
% \begin{equation}
% d_i^{t-1}=x_*-x_i^{t-1}
% \label{eq:d}
% \end{equation}
\begin{equation}
\mbox{\boldmath $v_i^{t+1}$}=\mbox{\boldmath $v_i^{t}$}+\mbox{\boldmath $(x_*-x_i^t)$}* f_i
\label{eq:ba-vi}
\end{equation}
\begin{equation}
\mbox{\boldmath $x_i^{t+1}$}=\mbox{\boldmath $x_i^{t}$}+\mbox{\boldmath $v_i^{t+1}$}
\label{eq:ba-xi}
\end{equation}
個体番号を$i$とし，各個体の周波数${f_i}$は個体の速度を制限するパラメータであり，$[0, \ 1]$の区間で表される．ここでは${f_{min}=0}$，${f_{max}=1}$として設定し，$\beta$は0から1の乱数が割り当てられる．
局所探索では，全個体の最良解（グローバルベスト）\mbox{\boldmath $x_*$}の周辺に新しい解候${x_{loc}}$を生成する．生成式は次の通りである．
\begin{equation}
\label{eq:ba-loc}
\mbox{\boldmath $x_{loc}$}=\mbox{\boldmath $x_*$} + \epsilon A_i^t
\end{equation}
パラメータ$\epsilon$は1 $\times$ $D$次元の配列で$[-1, \ 1]$区間のランダムな値が割り当てられる． ランダム探索では解探索空間にランダムで新たに解候補を生成する．生成式は以下の通りである．
\begin{equation}
\label{eq:ba-rnd}
\mbox{\boldmath $x_{rnd}$}=\mbox{\boldmath $x_{lb}$} + \mbox{\boldmath $(x_{ub}$} - \mbox{\boldmath $x_{lb})$}*rand(1,D)
\end{equation}
解探索空間の上限と下限をそれぞれ$x_{ub}, x_{lb}$とし，$rand$は0から1までの乱数が入る．
以上より各個体の解候補${x_i^{t+1}}$，${x_{loc}}$，あるいは$x_{rnd}$の評価値が各個体の最良解（パーソナルベスト）$x_{i*}$より良ければ更新され，同時にラウドネス$A$とその反射波であるパルスレート$r$も以下の式に基づいて更新される．
\begin{equation}
\label{eq:loud}
A_i^{t+1}= \alpha A_i^t
\end{equation}
\begin{equation}
\label{eq:pulse}
r_i^{t+1}=r_i^t[1-exp(- \gamma t)]
\end{equation}
解を更新する度にラウドネス$A_i$は徐々に減少し，それに比例して評価頻度を下げていく．対してパルスレート$r_i$は増加していき，探索が進むにつれて局所探索頻度が減少する．\\ \
従来のBAの疑似コードは以下のAlgorithm \ref{code:ba}に記す．

\begin{itemize}
\item {\bf STEP1: 個体の初期化 (1-3行目)}\\
探索空間内にランダムに個体$x_i (i=1,2,...,N)$を生成し，周波数$f_i$，ラウドネス$A_i^0$，パルスレート$r_i^0$を決定する．
\item {\bf STEP2: 速度の更新と解候補の生成 (6行目)}\\
速度$v_i$により新しく解候補を生成する．
\item {\bf STEP3: 局所探索 (8行目)}\\
全個体の最良解$x_{gbest}$近辺に新しく解候補$x_{loc}$を生成する．
\item {\bf STEP4: ランダム探索 (10行目)}\\
探索空間内にランダムで解候補$x_{rnd}$を生成する．
\item {\bf STEP5: 評価と更新 (11-13行目)}\\
${\rm rand} < A_i$を満たす，かつ3つの解候補が$t$時点での最良解$x_{pbest}$よりも評価値が高ければ解を更新する．
\item {\bf STEP6: STEP2へ戻る}\\
終了条件を満たすまでSTEP2へ戻る．
\end{itemize}

\begin{algorithm}[H]
\caption{Bat Algorithm}
\label{code:ba}
\begin{algorithmic}[1]
\REQUIRE Objective\ Function\ $F(x)$
\STATE Initialize Population $x_i(i=1,2,..., N)$ and $v_i$\\
\STATE Define frequency $f_i$ at location $x_i$ [eq.(\ref{eq:freq})]
\STATE Initialize pulse rates $r_i$, and loudness $A_i$
\WHILE{($t <$ Max number of iterations)}
\FOR{i=1 to N}
\STATE Generate a new solution $x_i$ and velocity $v_i$ [Eqs.(\ref{eq:ba-vi}) to (\ref{eq:ba-xi})]
\IF{($rand>r_i$)}
\STATE Generate a new solution $x_{loc}$ around a global best solution $x_i$ [Eq.(\ref{eq:ba-loc})] 
% \ELSE
% \STATE Continue
\ENDIF
\STATE Generate a new solution $x_{rnd}$ randomly [Eq.(\ref{eq:ba-rnd})]
\IF{($rand<A_i \& \max (F(x_i), F(x_{loc}), F(x_{rnd})>F(x_{pbest})$)}
\STATE Accept the new solution, and update pulse rate $r_i$ \\ \& loudness $A_i$ [Eqs. (\ref{eq:loud})(\ref{eq:pulse})]  
\ENDIF
\STATE Evaluate all bats and select a best solution $x_*$ in the current solutions
\ENDFOR
\STATE t=t+1
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\subsubsection{Evolution Strategies with Covariance Matrix Adaptation (CMA-ES)}
\label{sss:cma-es}
% 数式番号に章番号を追加
  % \makeatletter
  % \renewcommand{\theequation}{\arabic{section}-\arabic{subsection}-\arabic{equation}}
  % \@addtoreset{equation}{subsection}
  % \makeatother

Evolution Strategy with Covariance Matrix Adaptation (CMA-ES)　\cite{mu-CMA-ES}, \cite{CMA-ES} は進化戦略 (Evolution Strategy:ES) \cite{ES} のアルゴリズムを基に，変数間の依存関係を共分散行列 (Covariance matrix adaptation:CMA) \cite{CMA} により新しい変数を生成するアルゴリズムである．多変量正規分布を用いて解候補を生成し，それらの評価値を基に算出する共分散行列から探索範囲を決定する．CMA-ESの大きな特徴として，変数間の依存度を考慮している(パラメータチューニングを必要としない)という点と，単調に増減する線形的な問題に依存しないという点が挙げられる．CMA-ESには様々な手法がある中で，ここでは一般的な$(\mu|\mu_w,\lambda)$-CMA-ES \cite{CMA-ES} を紹介する．具体的なアルゴリズムについては以下のAlgorithm \ref{code:cma-es}に示し，終了条件を満たすまで以下の手順を繰り返す．
\begin{itemize}
\item {\bf STEP1: 個体の生成 (4行目)} 　\\
まず，正規分布$N(0,I)$の範囲で解候補$z_i (i=1,2,...,\lambda)$を独立に生成し，それを基に設計変数$x_i (i=1,2,...,\lambda)$を生成する．生成式は以下の通りである．
\begin{equation}
\label{eq:cmaes-yi}
\mbox{\boldmath $y_i^t$}=\mbox{\boldmath $\sqrt{C^t}z_i$}
\end{equation}
\begin{equation}
\label{eq:cmaes-xi}
\mbox{\boldmath $x_i^{t+1}$}=\mbox{\boldmath $m^t$}+ \sigma ^t \mbox{\boldmath $y_i$}
\end{equation}

設計変数$x_i$は共分散行列$N(0,(\sigma^t)^2 C^t)$の範囲から生成される．生成後，$x_i$を評価値で降順(評価値の高い順)にソートして順位付けし，$y_i$及び$z_i$も同様に順位付けする．$C^t$は，その共分散行列の範囲の広がり度合いを$d \times d$次元で表し，$\sigma^t$はステップサイズを，$m^t$は平均値ベクトル(探索範囲の中心)を表す．初期個体生成時，$C^0=I, \sigma^0=0$とする．また，$\lambda=4+[3In(n)]$, $\mu=[\frac{\lambda}{2}]$とする．

\item {\bf STEP2: $\mu$個体の荷重和を算出し，平均ベクトル$\mbox{\boldmath $m_i^t$}$を更新 (8行目)} \\
評価値で降順ソートした設計変数$\mbox{\boldmath $x_i$}$のうち，上位$\mu$個の荷重和を算出し，次式に従って平均値ベクトル$m$を更新する．
\begin{equation}
\label{eq:cmaes-mi}
\mbox{\boldmath $m^{t+1}$}=\mbox{\boldmath $m^t$}+ \sum_{i=1}^{\mu}w_i(\mbox{\boldmath $x_i^t$}-\mbox{\boldmath $m^t$})
\end{equation}
この時，重み$w$は次式で表される．
\begin{equation}
\label{eq:cmaes-w}
w_i=In(\frac{\lambda+1}{2})-In(i)
\end{equation}
重み$w$は$w_1 \geq w_2 \geq ... \geq w_\mu > 0$であり，$\sum_{i=1}^{\mu}w_i=1$を満たす．

\item {\bf STEP3: ステップサイズ$\sigma$の更新 (9行目)} \\
次式に従って進化パス$p_{\sigma}$及びステップサイズ$\sigma$を更新する．
\begin{equation}
\label{eq:cmaes-ps}
p_{\sigma}^{t+1}=(1-c_{\sigma})p_{\sigma}^t+\sqrt{c_{\sigma}(2-c_{\sigma})}\sqrt{\mu_{eff}}\sum_{i=1}^{\mu}w_i \mbox{\boldmath $z_i$}
\end{equation}
\begin{equation}
\label{eq:cmaes-s}
\sigma^{t+1}=\sigma^t exp(\frac{c_{\sigma}}{d_{\sigma}}(\frac{||p_{\sigma}^{t+1}||}{\hat{\chi_n}}-1))
\end{equation}
この時，$c_{\sigma}$は進化パス$p_{\sigma}$の前世代との重みを表し，$\mu_{eff}$は設計変数の上位$\mu$個の加重平均の補正値，$d_{\sigma}$はステップサイズの減衰係数，$\hat{\chi_n}$は$n$変量正規分布のノルムの期待値を表す．これらのパラメータは次式で表される．
\begin{equation}
\label{eq:cmaes-csig}
c_{\sigma}=\frac{4}{n+4}
\end{equation}
\begin{equation}
\label{eq:cmaes-mu-eff}
\mu_{eff}=\frac{1}{\sum_{i=1}^{\mu}w_i^2}
\end{equation}
\begin{equation}
\label{eq:cmaes-d}
d_{\sigma}=\frac{1}{c_{\sigma}}+1
\end{equation}
\begin{equation}
\label{eq:cmaes-chi}
\hat{\chi_n}=E[||N(0,1)||] \approx \sqrt{n}(1-\frac{1}{4n}+\frac{1}{21n^2})
\end{equation}
ここで$n$は最適化する数を表す．

\item {\bf STEP4: 共分散行列$C$の更新 (9行目)} \\
共分散行列$C$及びその進化パス$p_c$は次式で更新される．
\begin{equation}
\label{eq:cmaes-pc}
p_c^{t+1}=(1-c_c)p_c^t+\sqrt{c_c(2-c_c)} \sum_{i=1}^{\mu}w_i \mbox{\boldmath $y_i^t$}
\end{equation}
\begin{equation}
\label{eq:cmaes-c}
\mbox{\boldmath $C^{t+1}$}=\mbox{\boldmath $C^t$}+c_1[p_c^{t+1}(p_c^{t+1})^T+(1-c_c(2-c_c))\mbox{\boldmath $C^t$}]+c_{\mu}\sum_{i=1}^{\mu}w_i(\mbox{\boldmath $y_i(y_i)$}^T-\mbox{\boldmath $C^t$})
\end{equation}


$c_{\sigma}$は共分散行列$C$の進化パス$p_c$の前世代との重みであり，$c_1$及び$c_{\mu}$は共分散行列$C$の更新に用いられる学習率を表す．これらのパラメータは次式で表される．
\begin{equation}
\label{eq:cmaes-c1}
c_{1}=\frac{2}{(n+\sqrt{2})^2}
\end{equation}
\begin{equation}
\label{eq:cmaes-cmu}
c_{\mu}=1-c_1
\end{equation}
\begin{equation}
\label{eq:cmaes-cc}
c_c=\frac{4}{n+4}
\end{equation}

\end{itemize}

\begin{algorithm}[H]
\caption{CMA-ES}
\label{code:cma-es}
\begin{algorithmic}[5]
\REQUIRE Objective Function $F(x), x=(x_1,x_2,...,x_d)$
\STATE Calculate parameters [Eqs. (\ref{eq:cmaes-csig}) to (\ref{eq:cmaes-chi}), (\ref{eq:cmaes-c1}) to (\ref{eq:cmaes-cc})]
\WHILE{t $<$ Max Iteration}
\FOR{i=1 to N}
\STATE Generate solution $x_i (i=1,2,...,\lambda)$ within $N(0, \sigma^2 C)$ [Eqs. (\ref{eq:cmaes-yi}),(\ref{eq:cmaes-xi})]
\ENDFOR
\STATE Evaluate and sort solution $x_i$
\FOR{i=1 to N}
\STATE Update $m_i$ by $w_i$ [Eqs. (\ref{eq:cmaes-mi}),(\ref{eq:cmaes-w})]
\STATE Update step size $\sigma$ and covariance matrix $C$ by the evolution path $p_{\sigma}$ and $p_c$ [Eqs. (\ref{eq:cmaes-ps}),(\ref{eq:cmaes-s}),(\ref{eq:cmaes-pc}),(\ref{eq:cmaes-c})]
\ENDFOR
\STATE t=t+1
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\newpage
\section{Niching Scheme}
\label{sec:ns}
この章では，多峰性最適化問題において，EAsを拡張させて複数の最適解及び局所解探索を行うための機構であるNiching Schemeについて説明する．EAsは一つの最適解を探索することを目的とした設計であるため，複数の局所解を探索し，保持するには限界がある．この問題を解決するために導入した代表的なNiching Schemeのメカニズムについて\ref{ss:Crowding}節から\ref{ss:dns}節で紹介する．

\subsection{Crowding}
\label{ss:Crowding}
Crowding \cite{Crowding} は評価値が類似する最近傍個体同士を比較し，評価値の高い方を残す．この時，比較する個体は親集合と子集合を含めた全個体における最近傍個体同士が比較対象となる．この動作を毎世代繰り返すことによって同じ局所解に個体が陥らないことを目的とした機構である．

\subsection{Niche Radius}
\label{ss:nr}
Niche Radiusは探索空間の大きさと局所解数(あるいは個体数)に基づいて算出される距離であり，次式で表される．
\begin{equation}
\label{eq:nr-d}
dist=\frac{1}{2}\sqrt{(x_{ub}-x_{lb})^2}
\end{equation}
\begin{equation}
\label{eq:nr-s}
\sigma=\frac{dist}{\sqrt[D]{q}}
\end{equation}
この時，$x_{ub},x_{lb}$は探索空間の上限と下限を表しており，$D$は次元数を表す．$q$は解の数(あるいは個体数)が適用される．

\subsection{Fitness Sharing}
\label{ss:fs}
Fitness Sharing \cite{FS} はCrowdingと同様，類似個体の評価値が低い方を淘汰させるための機構として用いられる．ここでは，その類似度を定義することで，同じ類似度を持つ個体同士が評価値を比較する．一般的に，類似度の算出方法は次式で表される．
\begin{equation}
\label{eq:sfunc}
sh(d_{ij})= \begin{cases}
1-(\frac{d_{ij}}{\sigma})^\alpha & ({\rm if} \ d_{ij} < \sigma)\\
0 & ({\rm otherwise})
\end{cases}
\end{equation}
ここで$d_{ij}$は個体$i,j$の間の距離を表し，$\alpha$は係数で$\sigma$はある恣意的な閾値(あるいはNiche radius)を表す．個体間距離が近いほどSharing function $sh(d_{ij})$の値は大きくなり，この数値を基にNiche count $m_i$を算出する．
\begin{equation}
\label{eq:nc}
m_i=\sum_{j=1}^N sh(d_{ij})
\end{equation}
Niche count $m_i$は$i$番目の個体に対する全個体の密度を表している．このNiche countより，Shared fitness $f_i'$が次式のように算出される．
\begin{equation}
\label{eq:sfit}
\phi_i=\frac{F_i}{m_i}
\end{equation}
ここで，$F_i$は$i$番目の個体の評価値を表す．Shared fitness $\phi_i$は，その個体密度であるNiche count $m_i$によって値が大きく変動する．$\phi_i$の値が小さいほど$i$番目の個体密度は高く，値が大きければ個体密度は低いということになる．

\subsection{Dynamic Niche Sharing}
\label{ss:dns}
\ref{ss:fs}節で前述したShared fitnessを用い，Dynamic niche sharing \cite{DNS} は次式で表される．
\begin{equation}
\label{eq:dns}
m_i^{dyn}=\begin{cases}
n_j & ({\rm if \ individual}\ i {\rm \ is \ within \ the \ dynamic \ niche }\ j) \\
m_i & ({\rm otherwise})
\end{cases}
\end{equation}
Dynamic Niche Sharingは個体の分布密度に応じてNiche countを変化させることで，各個体が異なるNiche countを持つ．これにより，個体の分布が密であればniche countは大きくなる．
% \subsection{クラスタリング}
% \label{ss:clustering}
% クラスタリングは対象となる集合の全個体に対して部分集合に分割する手法である．クラスタリングは，{\bf 階層的クラスタリング}と{\bf 非階層的クラスタリング}の２つに分類される．

% \subsubsection{階層的クラスタリング}
% \label{sss.hc}
% 階層的クラスタリング(Hierarchical Clustering)は，一般的に$N$個のデータ(個体)が与えられたときに初期状態として$N$個のクラスタを生成する．次にクラスタ間の距離に基づいてクラスタ同士を併合させる．一つのクラスタになるまでこの併合を繰り返す．代表的なクラスタ分類に関して以下の手法がある．
% \begin{itemize}
% \item {\bf 最短距離法(Nearest neighbor method)} \\
% 最近傍クラスタ同士を併合していく手法 \cite{NN-Clustering} である．クラスタ間の距離$d(C_1,C_2)$は次の式で定義される．
% \begin{equation}
% d(C_1,C_2) = \min_{x_i \in C_i, x_j \in C_j}(d(x_i,x_j))
% \end{equation}
% \item {\bf 最長距離法(furthest neighbor method)} \\
% 最も遠いクラスタ同士を併合する手法 \cite{FN-Clustering} である．クラスタ間の距離$d(C_1,C_2)$は次の式で定義される．
% \begin{equation}
% d(C_1,C_2) = \max_{x_i \in C_1, x_j \in C_2}(d(x_i,x_j))
% \end{equation}
% \item {\bf 群平均法(group average method)} \\

% \begin{equation}
% d(C_1,C_2) = \frac{1}{|C_1||C_2|}\sum_{x_i \in C_1} \sum_{x_j \in C_2}d(x_i,x_j)
% \end{equation}
% \item {\bf ウォード法(Ward's method)} \\
% \begin{equation}
% d(C_1,C_2) = E(C_1 \cup C_2)-E(C_1)-E(C_2)
% \end{equation}
% \item {\bf 重心法(Centroid method)} \\
% 重心法は
% \begin{equation}
% d(C_1,C_2) = d(\bar{x_i},\bar{x_j})
% \end{equation}
% \end{itemize}

% \subsubsection{非階層的クラスタリング}
% \label{sss:nhc}
% 非階層的クラスタリング(Non-hierarchical Clustering)は

% \begin{itemize}
% \item k-means法
% \end{itemize}

\newpage
\section{Niching Methods}
\label{sec:nm}
本章では，前述したMetaheuristic Algorithmに対し，Niching schemeを組み合わせた複数解探索手法について説明する．複数最適解探索問題のコンペティションであるCEC ({\it IEEE Congress on Evolutionary Computation})  2013 on Niching Methods for Multimodal Function Optimization \cite{CEC2013} で使用された手法を次節より紹介し，9章にて同じ評価関数を用いて提案手法(6,7,8章で後述)との探索性能を比較する．

\subsection{Crowding DE (CDE)}
\label{ss:cde}
\ref{sss:DE}節で説明したDEをベースとし，Crowding \cite{Crowding} と組み合わせた手法で，生成された子集合の中から最近傍である子$u_{{i,j}_{NN}}$と親$x_{pbest_i}$を選択し，評価値の低い個体は淘汰され，評価値の高い方は次世代に引き継がれる．

\begin{algorithm}[H]
\caption{CDE/rand/1}
\label{code:cde}
\begin{algorithmic}[3]
\REQUIRE Objective Function $f(x), x=(x_1,x_2,...,x_d)$
\STATE Initialize Population $x_i (i=1,2,...,N)$ 
\STATE Define crossover probability $C_r,$ and scaling factor $F$

\WHILE{t $<$ Max Iteration}
\FOR{i=1 to N}
\STATE Select random integer $r_1, r_2 \in \{ 1,2,..., N| r_1 \neq r_2 \neq i\}$
\STATE Generate a candidate $v_{i,j}$  [Eq. (\ref{eq:rand1})]
\FOR{$j=1$ to $D$}
\IF{$rand(0, 1) \leq C_r \ or \ j=D$}
\STATE offspring $u_{i,j} = v_{i,j}^{t+1}$
\ELSE[$rand(0,1) > C_r \ and \ j \neq D$]
\STATE offspring $u_{i,j} = x_{i,j}^t$
\ENDIF
\ENDFOR
\IF{$f(u_{{i,j}_{NN}}^{t+1})>f(x_{pbest_i})$}
\STATE Replace the offspring $u_{{i,j}_{NN}}$ as $x_{pbest_i}$
\ENDIF
\ENDFOR
\STATE t=t+1
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\subsection{A Dynamic Archive Niching Differential Evolution (dADE)}
\label{ss:dADE}
{\it Niching methods}は，最適解の数が多くなるほど，個体数を増やすといったアルゴリズムのパラメータチューニングが必要となる．そこで，dADE \cite{dADE} のアルゴリズムは動的にパラメータを制御する2つのメカニズムの改良を行った．1つ目のメカニズムとして，環境に応じてパラメータの値を自動的に変化させ，2つ目のメカニズムとして未探索領域に解候補を生成するよう変更を加えた．

\begin{itemize}
\item {\bf STEP1: 最近傍個体間距離$R$の算出} \\
DEは主に，突然変異率$C_r$とスケール因子$F$の制御によって探索を決定しているが，複数解探索を行う上では，探索領域全体を網羅するよう個体を配置させることが重要となる．ここではまず，個体の密度を算出する．

\begin{equation}
\label{eq:dADE-rmin}
R=\min{(r^1, r^2, ...,r^t)}
\end{equation}
\begin{equation}
\label{eq:dADE-r}
r^t=\frac{\sum_{i=1}^n dist_i}{n}
\end{equation}
\begin{equation}
\label{eq:dADE-dist}
dist_i=\min{||x_i^t-x_j^t||:\forall_{x_i^t, x_j^t} \in P}
\end{equation}
この時，$r^t$は各個体の最近傍個体とのユークリッド距離の平均値を示す．個体が同じ場所に密集しているほど$r$の値は0に近づくことを意味する．

\item {\bf STEP2: 突然変異率$C_r$とスケール因子$F$の更新} \\
各世代において，突然変異率$C_r$とスケール因子$F$は，2つの確率分布$CR_i \sim N(\mu_{CR},0.1)$, $F_i \sim Cauchy(\mu_F, 0.1)$に従って生成される．
\begin{equation}
\label{eq:dADE-f}
\mu_F = (1-c) \cdot \mu_F + c \cdot {\rm mean}_L(S_F)
\end{equation}

\begin{equation}
\label{eq:dADE-cr}
\mu_{CR} = (1-c) \cdot \mu_{CR} + c \cdot {\rm mean}_A(S_{CR})
\end{equation}
ここで，$c$は$c \in [0, \ 1]$の係数(既定値は0.1)であり，${\rm mean_L}(\cdot)$はLehmer mean \cite{Lehmer} を指し，次式で表される．
\begin{equation}
{\rm mean_L}=\frac{\sum_{F \in S_F}F^2}{\sum_{F \in S_F}F}
\end{equation}
 ${\rm mean_A}(\cdot)$は$t$世代目の突然変異率ベクトル$S_{CR}$の平均値を示す．

\item {\bf STEP3: 交叉} \\
\ref{sss:DE}節と同様，突然変異率$CR$に基づいて解候補$u_{i,j}$を決定する．

\item {\bf STEP4: 評価と更新} \\
最良個体と生成した解$u_{i,j}^{t+1}$を比較し，評価値の高い方を次世代に引き継ぐ．

\item {\bf STEP5: Dynamic Archiveによる各個体の最良解$x_{pbest_i}$の再生成} \\
Archiveの疑似コードをAlgorithm \ref{code:dynA}に記す．
各個体の最良解$x_{pbest_i}$を$p$として集合$S$に格納し，$\delta$よりも評価値が良ければupdateにTRUEを返す(2-7行目)．次に，updateがTRUE，あるいは$\delta$の評価値と$p$の評価値の差分がaccuracy level: $\varepsilon$よりも小さければ(8行目)，$p$と$s$のユークリッド距離に着目し，その距離が$R$以下であれば$s$は新しく$p$として置き換えられ，foundにTRUEを返し(9-14行目)，$R$より大きければfoundにTRUEを返す(15-18行目)．最後に，foundがFALSEならば，集合$S$に$p$を追加する(21-24行目)．この手順を繰り返すことで，閾値$\varepsilon$を満たす最近傍個体同士を比較し，評価値の低い個体は新たに生成される．

\item {\bf STEP6: STEP1へ戻る} \\
終了条件を満たすまでSTEP1からSTEP5までの手順を繰り返す．

\end{itemize}

\begin{algorithm}[H]
\caption{dADE/nrand/1}
\label{code:dADE}
\begin{algorithmic}[3]
\STATE Initialize Population $x_i (i=1,2,...,N)$ 
\STATE Define crossover probability $C_r,$ and scaling factor $F$
\WHILE{t $<$ Max Iteration}
\STATE Calculate the $R$ value [Eq. (\ref{eq:dADE-r})]
\FOR{i=1 to N}
\STATE Update parameters $CR$ and $F$ [Eqs. (\ref{eq:dADE-f}),(\ref{eq:dADE-cr})]
\STATE Select random integer $r_1, r_2 \in \{ 1,2,..., N| r_1 \neq r_2 \neq i\}$
\STATE Generate a candidate $v_{i,j}$  [Eq. (\ref{eq:rand1})]
\FOR{$j=1$ to $D$}
\IF{$rand(0, 1) \leq C_r \ or \ j=D$}
\STATE offspring $u_{i,j} = v_{i,j}^{t+1}$
\ELSE[$rand(0,1) > C_r \ and \ j \neq D$]
\STATE offspring $u_{i,j} = x_{i,j}^t$
\ENDIF
\ENDFOR
\IF{$f(u_{{i,j}_{NN}}^{t+1})>f(x_{pbest_i})$}
\STATE Replace the offspring $u_{{i,j}_{NN}}$ as $x_{pbest_i}$
\STATE Insert $x_{pbest_i}$ to Dynamic Archive [Algorithm \ref{code:dynA}]
\IF{$x_{pbest_i}$ is already in Archive (found == TRUE)}
\STATE Re-initialize individual $x_{pbest_i}$
\ENDIF
\ENDIF
\ENDFOR
\STATE t=t+1
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[H]
\caption{The algorithmic scheme for building a dynamic archive}
\label{code:dynA}
\begin{algorithmic}[3]
\REQUIRE $p \in \mathbb{R}^D$ a potential solution, $R \in \mathbb{R}$ the niche radius, and $\varepsilon$ an accuracy level or acceptance threshold
\ENSURE $S$ - a list of found solutions in a dynamic archive
\STATE found $\leftarrow$ FALSE; update $\leftarrow$ FALSE;
\IF{$S= \emptyset$}
\STATE $S \leftarrow S \cup {p}; \delta \leftarrow f(p)$
\ELSE
\IF{$f(p)> \delta$}
\STATE $\delta \leftarrow f(p)$; update $\leftarrow$ TRUE
\ENDIF
\IF{update {\bf or} $|f(p)- \delta| < \varepsilon$}
\FOR{each $s \in S$}
\IF{$||p-s||\leq R$}
\IF{$f(p)>f(s)$}
\STATE $s \leftarrow p$;
\STATE found $\leftarrow$ TRUE;
\STATE break;
\ELSE
\STATE found $\leftarrow$ TRUE;
\STATE break;
\ENDIF
\ENDIF
\ENDFOR
\IF{{\bf not} found}
\STATE $S \leftarrow S \cup {p}$
\ENDIF
\ENDIF
\ENDIF
\end{algorithmic}
\end{algorithm}

\subsection{Niching the CMA-ES via Nearest-Better Clustering (NEA)}
\label{ss:nea}
CMA-ESが局所解へ収束してしまうことを防ぐため，NEA \cite{nea} では次の2つの改良を加えた．(i)Niche radiusを予想する; (ii)求めたNiche radiusから探索性能を制御する．

\begin{itemize}
\item {\bf STEP1: 個体の初期化} \\
個体を探索空間内にランダムで生成する．
\item {\bf STEP2: NBCによる個体のクラスタリング}\\
Nearest-better clustering (NBC) \cite{NBC} は，探索空間の個体間距離に応じて各個体の探索範囲をクラスタで分割する手法である．NBCのクラスタリングのイメージを図\ref{fig:nbc}に，疑似コードをAlgorithm \ref{code:nbc}に記す．図\ref{fig:nbc}中の四角や丸，星は初期生成後の個体$x_i (i=1,2,...,7)$を表しており，$i$番目の個体$x_i$に対してより良い評価値を持つ最近傍個体とエッジ(矢印)を繋げる．この時，エッジの平均値とパラメータ$\phi$の乗算よりもエッジが大きい場合，そのエッジ(点線の矢印)を削除し，エッジで繋がれた個体(実線の矢印)を一つのグループとして生成する．ここではクラスタ$C_1=\{x_1\}, C_2=\{x_2, x_3, x_4\}, C_3 = \{x_5, x_6\}, C_4=\{x_7\}$の４つに分類され，各クラスタの最良解(パーソナルベスト)は$x_1, x_4, x_6, x_7$であり，全個体の最良解(グローバルベスト)は$x_7$である．
\item {\bf STEP3: CMA-ESを用いた探索} \\
分類されたクラスタ毎にCMA-ESにより探索を開始する(探索手順は\ref{sss:cma-es}節を参照)．
\item {\bf STEP4: STEP2へ戻る}\\
終了条件を満たすまでSTEP2,3を繰り返す．
\end{itemize}

\begin{figure}[t]
\centering
\includegraphics[width=0.8\linewidth]{eps/nbc.eps}
\caption{an example of NBC}
\label{fig:nbc}
\end{figure}

\begin{algorithm}[H]
\caption{Nearest-better clustering (NBC)}
\label{code:nbc}
\begin{algorithmic}[3]
\STATE Calculate all search points mutual distances
\STATE Create an empty graph with num (search points) nodes
\FOR{the search points}
\STATE Find nearest search point that is better, create edge to it
\ENDFOR
\STATE Delete edges of length $> \phi \cdot$ mean(length of all edges)
\STATE Find connected components 
\end{algorithmic}
\end{algorithm}

% \subsection{Parameterless-Niching-Assisted NSGAII (PNA-NSGAII)}
% \label{ss:PNA-NSGA}
% 多目的最適化問題によく用いられるNSGA-IIだが，ここでは単目的の最適化問題に対して，どのような問題に対しても適応できるノンパラメトリックなPNA-SNGAII \cite{PNA-NSGA}について説明する．

% 最適解数に対して同じ個体数を用いることが理想的であるため，ここでは次式で個体数を決定する．
% \begin{equation}
% T^D=N \Rightarrow T \simeq [e^{\frac{InN}{D}}]
% \end{equation}

% niching distance $v_d$を次式で求める．
% \begin{equation}
% v_d=\frac{x_d^{(U)}-x_d^{(L)}}{T} \forall d=\{ 1,2,...,D\}
% \end{equation}

% \begin{equation}
% |(x_1-x_2)_d| \leq \forall d = \{1,2,...,D\}
% \end{equation}


% % \begin{cases}
% $(f_m(x_1) \leq f_m(x_2) \forall_m) \wedge (\exists_n | f_n(x_1) < f_n(x_2)), \ {\rm proximate}(x_1, x_2) = 1   {\rm if }  x_1 \succ x_2 $ \\
% $x_1 \ {\rm and} \ x_2 \ {\rm are \ non dominated}  {\rm otherwise}$
% % \end{cases}



\newpage
\section{多峰性最適化問題}
\label{sec:MOP}
最適化問題において，実問題の複雑さを多峰性と見立てた評価関数を実験で用いられている．その代表的な多峰性関数を次節で説明する．


\subsection{最小化問題における評価関数}
\label{ss:MinFunc}
最適解及び局所解の位置が既知である評価関数を扱う(ただし，実験時には関数はブラックボックス化されており，評価する時のみ解の位置情報を利用する)．
実験で用いられる評価関数の最適解の評価値，最適解数，探索範囲を表\ref{tab:minMOP}に示す．また関数の概形を図\ref{fig:minF1}-\ref{fig:minF4}に示し，その評価値を色濃度で表す．関数の概形図は，2変数$x_1, x_2$を用いて評価値を表した3次元空間で構成されている．

\begin{description}
\item[$F_1$: Griewank (2D)]\mbox{}\\
Griewank関数 \cite{MOP} の概形を図\ref{fig:minF1}に示し，関数式は次式で表される．
\begin{equation}
\label{eq:minF1}
F_1(x_i)=\sum_{i=1}^D \frac{x_i}{4000}- \prod_{i=1}^D \cos(\frac{x_i}{\sqrt{i}})+1.
\end{equation}
解空間の探索領域は$x_i \in [-10, \ 10]$である$(i=1,2)$．最適解の座標は$x_*=[0, \ 0]$で，その評価値は$F(x_*)=0$である．局所解の座標は$\pm x \approx [6.2800, \ 8.8769], [3.1400, \ 4.4385]$, \\ $[0, \ 8.8769],$  $ [6.2800, \ 0], [9.4200, \ 4.4385]$となる．
\begin{figure}[t]
\centering
\subfigure[Fitness Landscape]{
\includegraphics[width=0.8\linewidth]{eps/3d_griewank.eps}
\label{fig:minF1(3d)}}
\subfigure[Contour Plot]{
\includegraphics[width=0.8\linewidth]{eps/cont_griewank.eps}
\label{fig:minF1(2d)}}
\caption{Griewank}
\label{fig:minF1}
\end{figure}

\item[$F_2$: Rastrigin (2D)]\mbox{}\\
Rastrigin関数 \cite{MOP} の概形を図\ref{fig:minF2}に示し，関数式は次式で表される．
\begin{equation}
\label{eq:minF2}
F_2(x_i)=10D+\sum_{i=1}^D[x_i^2-10\cos(2\pi x_i)].
\end{equation}
$D$は次元数であり，探索領域は$x_i \in [-5, \ 5]$である．
\begin{figure}[t]
\centering
\subfigure[Fitness Landscape]{
\includegraphics[width=0.8\linewidth]{eps/3d_rastrigin.eps}
\label{fig:minF2(3d)}}
\subfigure[Contour Plot]{
\includegraphics[width=0.8\linewidth]{eps/cont_rastrigin.eps}
\label{fig:minF2(2d)}}
\caption{Rastrigin}
\label{fig:minF2}
\end{figure}

\item[$F_3$: Six-Hump Camel　(2D)]\mbox{}\\
最適解と局所解が各2個存在するSix-Hump Camel Function \cite{MOP} は以下の式で表される．
\begin{equation}
\label{eq:minF3}
F_3(x_1,x_2)=(4-2.1x_1^2+ \frac{x_1^4}{3})x_1^2+x_1x_2+(-4+4x_2^2)x_2^2
\end{equation}
この関数における解空間の探索領域は$x_1 \in [-2, \ 2]$, \ $x_2 \in [-1, \ 1]$である．最適解の座標は$x_*=[0.0898, \ -0.7126], [-0.0898, \ 0.7126]$であり，その評価値は$F_3(x_*)=-1.0316$である．また局所解は$\pm x \approx [1.704, \ -0.7965]$に位置する．
\begin{figure}[t]
\centering
\subfigure[Fitness Landscape]{
\includegraphics[width=0.8\linewidth]{eps/3d_sixhump_camel.eps}
\label{fig:minF3(3d)}}
\subfigure[Contour Plot]{
\includegraphics[width=0.8\linewidth]{eps/cont_sixhump_camel.eps}
\label{fig:minF3(2d)}}
\caption{Six-Hump Camel}
\label{fig:minF3}
\end{figure}

\item[$F_4$: Michalewicz (2D)]\mbox{}\\
Michalewicz Function \cite{MOP} の数式を以下に示す．
\begin{equation}
\label{eq:minF4}
F_4(x_i)=- \sum_{i=1}^D \sin(x_i)\sin^{2m}(\frac{ix_i^2}{\pi})
\end{equation}
最適解$x_*=[2.20, \ 1.57]$の評価値$F_3(x_*)=-1.8013$であり，局所解は$x \approx [2.203 \ 2.7115]$である．探索領域は$x_i \in [0, \ 4]$である（$i=1,2$）．
\begin{figure}[t]
\centering
\subfigure[Fitness Landscape]{
\includegraphics[width=0.8\linewidth]{eps/3d_michalewicz.eps}
\label{fig:minF4(3d)}}
\subfigure[Contour Plot]{
\includegraphics[width=0.8\linewidth]{eps/cont_michalewicz.eps}
\label{fig:minF4(2d)}}
\caption{Michalewicz}
\label{fig:minF4}
\end{figure}

\item[$F_5$: Himmelblau (2D)]\mbox{}\\
Himmelblau Function \cite{himmelblau} の関数式は次の通りとなる．
\begin{equation}
\label{eq:minF5}
F_5(x_1,x_2)=(x_1^2+x_2-11)^2+(x_1+x_2^2-7)^2
\end{equation}
評価関数に局所解は存在せず，最適解のみ4個持つ関数である．最適解の位置は各々$x_*=[3, \ 2]$,$[-2.805118, \ 3.283186]$,$[-3.779310,$  \ $-3.283186],$ $[3.584458, \ -1.848126]$にあり，その評価値は$F_4(x_*)=0$である．探索領域は$x_i \in [-5, \ 5]$となる($i=1,2$)．
\begin{figure}[t]
\centering
\subfigure[Fitness Landscape]{
\includegraphics[width=0.8\linewidth]{eps/3d_himmelblau.eps}
\label{fig:minF5(3d)}}
\subfigure[Contour Plot]{
\includegraphics[width=0.8\linewidth]{eps/cont_himmelblau.eps}
\label{fig:minF5(2d)}}
\caption{Himmelblau}
\label{fig:minF5}
\end{figure}

\item[$F_6$: Shubert Function]\mbox{}\\
Shubert関数の概形及び等高線を図\ref{fig:minF6}に示す.
 \begin{equation}
F_6(x_i) = \prod_{i=1}^D \sum_{j=1}^5 j \cos[(j+1)x_i+j], 
\end{equation}
$D$は次元数を表し，最適解の評価値は${F(x_*)=-187.731}$である.この関数では$D \cdot 3^D $個の最適解のみ存在し，2次元では18個の最適解を持つ．探索範囲は$x_i \in [-10, 10]^D$ $(i=1,2,...,D)$である.
\begin{figure}[h]
\centering
\subfigure[Fitness landscape]{
\includegraphics[width=0.8\linewidth]{eps/3d_shubert.eps}
\label{fig:minF6(3d)}}
\subfigure[Contour plot]{
\includegraphics[width=0.8\linewidth]{eps/cont_shubert.eps}
\label{fig:minF6(2d)}}
\caption{$F_6$: Shubert}
\label{fig:minF6}
\end{figure}
\end{description}

\begin{table}[h]
\caption{Benchmark Test Functions}
\begin{center}
\begin{tabular}{c|c|c|c|c|c}
\hline

Function & $F(x*)$ & Num of & Num of & $D$ & Search Range \\
& & global optima & local optima & & \\
\hline
$F_1$ & 0 & 1 & 16 &  2 & $x_i \in [-10,10]$  \\
\hline
$F_2$ & 0 & 1 & 120 & 2 & $x_i \in [-5,5]$  \\
\hline
$F_3$ & -1.0316 & 2 & 2 & 2 & $x_1 \in [-2,2]$  \\
& & & & & $x_2 \in [-1,1]$ \\
\hline
$F_4$ & -1.8013 & 1 & 2 & 2 & $x_i \in [0,4]$  \\
\hline
$F_5$ & 0 & 4 & 0 & 2 & $x_i \in [-5,5]$, \\
\hline
$F_6$ & -187.731 & 18 & many & 2 & $x_i \in [-10,10]$, \\
\hline
\end{tabular}
\label{tab:minMOP}
\end{center}
\end{table}


\FloatBarrier


% \subsection{月面着陸地点選定問題}
% \label{ss:LSM}
% 実問題の一例として，進化計算シンポジウムコンペティション2018で取り上げられた月着陸における最適着陸地点選定問題 \cite{ECCompetition} が挙げられる．

\clearpage
\newpage
\section{Novelty Search-based Bat Algorithm (NSBA)}
\label{sec:NSBA}

他の複数解探索手法の問題点として大域探索と局所探索を同時に行えない，あるいは近傍個体間の距離に基づいた解の移動しか行っていないことが例としてあげられる．そこで本章では多峰性最適化問題に対し，大域探索と局所探索を自動で切り替えることに優れたBat Algorithm (BA) と，未探索領域に解を生成するNovelty Searchを組み合わせたNSBA \cite{NSBA} を用いることで本問題の解決を図る．次節よりNSBAについて説明する．

\subsection{Novelty Search}
\label{ss:NS}
Novelty Search \cite{NS} は未探索領域に新たに解を生成することを目的とした手法である．個体間距離の算出式は次式で表される．
\begin{equation}
\label{eq:ns}
\rho(x)=\frac{1}{k}\sum_{i=1}^k dist(x,\mu_i)
\end{equation}
この時，$\rho(x)$は個体$x$における密度を表しており，$kは$個体$x$の近傍数，$dist$は個体$x$と$\mu_i$の距離を表す．図\ref{fig:ns}は近傍数が3の時の解の生成を表す．
\begin{figure}[h]
  \centering
  \includegraphics[width=0.8\linewidth]{eps/IES2018/ns.eps}
  \caption{解候補の生成}
  \label{fig:ns}
\end{figure}

\subsection{メカニズム}
\label{ss:NSBA-abst}
NSBAはBAにNovelty Searchを組み込んだ複数解探索手法であり，BAからの変更点を図\ref{fig:nsba_table}に表す．(\ref{eq:ns})式を以下のベクトル式に変更することで，密集している個体が疎な方向へ新たに解候補を生成する．

\begin{figure}
  \centering
  \includegraphics[width=0.7\linewidth]{eps/nsba_table.eps}
  \caption{BAからの変更点}
  \label{fig:nsba_table}
\end{figure}
\begin{equation}
\mbox{\boldmath $d_i^{t}$} = \frac {1}{N} \sum _{j=1}^N \frac {(\mbox{\boldmath $x_{pbest}$}-\mbox{\boldmath $x_j^{t}$})}{|\mbox{\boldmath $x_{pbest}$}-\mbox{\boldmath $x_j^{t}$}|^2}
\label{eq:nd*}
\end{equation}
\begin{equation}
\mbox{\boldmath $v_i^{t+1}$}=\mbox{\boldmath $v_i^{t}$}+\mbox{\boldmath $d_i^{t}$}*f_i
\label{eq:nsvi}
\end{equation}
この時，$x_{pbest}$は$i$番目の最良個体を表し，このベクトル式から速度$v_i$を更新する．

局所探索では，最良個体$x_{pbest}$付近に新たに解候補を次式で生成される．
\begin{equation}
\mbox{\boldmath $x_{loc}$}=\mbox{\boldmath $x_{pbest}$} + \epsilon A^t,
\label{eq:ns_xloc}
\end{equation}
$\epsilon$は$[-1, \ 1]$区間におけるD次元の一様乱数を表す．
ランダム探索では，探索空間内に新たに解候補を生成する．
\begin{equation}
\mbox{\boldmath $x_{rnd}$} = x_{lb} + (x_{ub} - x_{lb})* rand(1, \ D)
\label{eq:ns_rnd}
\end{equation}

\subsection{アルゴリズム}
\label{ss:NSBA-algorithm}
アルゴリズムの疑似コードを以下のAlgorithm \ref{code:nsba}に記す．

\begin{itemize}
\item {\bf STEP1: 個体の初期化}\\
探索空間内にランダムに個体$x_i (i=1,2,...,N)$を生成し，周波数$f_i$，ラウドネス$A_i^0$，パルスレート$r_i^0$を決定する(1-3行目)．
\item {\bf STEP2: 速度の更新と解候補の生成}\\
速度$v_i$により新しく解候補を生成する(6行目)．
\item {\bf STEP3: 局所探索}\\
最良解$x_{pbest}$近辺に新しく解候補$x_{loc}$を生成する(8行目)．
\item {\bf STEP4: ランダム探索}\\
探索空間内にランダムで解候補$x_{rnd}$を生成する(10行目)．
\item {\bf STEP5: 評価と更新}\\
${\rm rand} < A_i$を満たす，かつ3つの解候補が$t$時点での最良解$x_{pbest}$よりも評価値が高ければ解を更新する(11-14行目)．
\item {\bf STEP6: STEP2へ戻る}\\
終了条件を満たすまでSTEP2へ戻る．
\end{itemize}

\begin{algorithm}[H]
\caption{Novelty Search-based Bat Algorithm}
\label{code:nsba}
\begin{algorithmic}[6]
\REQUIRE Objective\ Function\ $F(x)$
\STATE Initialize Population $x_i(i=1,2,..., N)$ and $v_i$\\
\STATE Define frequency $f_i$ at location $x_i$ [Eq.(\ref{eq:freq})]
\STATE Initialize pulse rates $r_i$, and loudness $A_i$
\WHILE{($t <$ Max number of iterations)}
\FOR{i=1 to N}
\STATE Generate a new solution $x_i$ and update velocity $v_i$  [Eqs.(\ref{eq:ba-xi})(\ref{eq:nd*})(\ref{eq:nsvi})] 
\IF{($rand>r_i$)}
\STATE Generate a new solution ${x_{loc}}$ around the solution $x_{i}$ [Eq.(\ref{eq:ns_xloc})] 
\ENDIF
\STATE Generate a new solution $x_{rnd}$ randomly (or without ${x_{rnd}}$) [Eq. (\ref{eq:ns_rnd})]
\IF{($rand<A_i \ \& \min (F(x_i), F(x_{new}), F(x_{rnd}))<F(x_{i*})$)}
\STATE Accept the new solution, and update pulse rate $r_i$ \\ \& loudness $A_i$ [Eqs. (\ref{eq:loud})(\ref{eq:pulse})] 
\ENDIF
\ENDFOR
\STATE Evaluate the all bats and select a best solution $x_{i*}$ in the current solutions
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\subsection{実験}
\label{ss:NSBA-exp}
本実験では従来のBAとNSBAの性能を比較するため，代表的な以下の多峰性関数を用いる．

\subsubsection{評価関数}
\label{sss:NSBA-func}
本実験では\ref{ss:MinFunc}節で説明した$F_1$関数(Griewank)と$F_2$関数(Rastrigin)を用いる．


\FloatBarrier

\subsubsection{評価基準}
\label{sss:NSBA-eval}
本実験ではPeak Ratio (PR) \cite{CDE} を採用し，最適解及び局所解の発見率を次式で求める．
\begin{equation}
\label{eq:PR}
PR=\frac{\sum_{run=1}^{MR}FPs}{TP*MR}
\end{equation}
ここで，$TP$は評価関数の全最適解と局所解数(Total Peak)を表し，$MR$は実験回数(Max Run)を表す．$FPs$は発見した解の数(Found Peaks)を表す．解発見の定義はピークとその最近傍個体とのユークリッド距離が0.1未満であった時，その解を発見したとする．

\subsubsection{実験設定}
\label{sss:nsba-setup}
本実験では，$F_1$関数では個体数$N=50,100$，$F_2$関数では$N=100,150$とした．2つの関数において，$f_{max}=1, f_{min}=0$, ラウドネス$A^0=1$, パルスレート$r^0 \in rand[0,1]$とし，$\alpha = \gamma = 0.9$と設定した．世代数は10000，実験回数を30回とした．

\subsubsection{実験結果}
\label{sss:nsba-results}
\begin{itemize}
\item {\bf PRと発見した解数} \\
表\ref{tab:nsba}はBAとNSBAにおける，発見した解の数(FPs)とその発見率(PR)の30試行回数による平均値と標準偏差を示す．表\ref{tab:nsba}より2つの関数に対し，NSBAはBAよりもFPs及びPR値が高いことから探索性能が良好である．図\ref{fig:nsba-results_ba}, \ref{fig:nsba-results_nsba}は最終世代における解の分布を表し，白い丸が解の位置である．図よりBAは一つの最適解に収束する傾向にあるが，一方でNSBAは最適解とその周辺にある複数の局所解に留まっていることが分かった．
\item {\bf 収束速度} \\
図\ref{fig:nsba-all_iter}はNSBAとBAの世代数によるPR値の推移を表しており，縦軸はPR値，横軸は世代数を示す．黒い実線はBA，黒い点線はNSBAの推移を示している．図\ref{fig:nsba-f1_n50}から\ref{fig:nsba-f2_n150}でBAは最終世代において，PR値が0\%付近で収束しているのに対し，NSBAは$F_1$関数では70\%までPR値が上昇し，1000世代以降は徐々に低下する傾向にある．$F_2$関数ではNSBAのPR値が20\%から10\%まで減少し，3000世代以降は停滞する傾向が見られた．
\end{itemize}  

\begin{table}[h]
\caption{Found Peaks and Peak Ratio of BA and NSBA}
\begin{center}
\begin{tabular}{c|c|c|c|c|c|c}
\hline
\multicolumn{1}{c|}{} & \multicolumn{3}{c|}{BA} & \multicolumn{3}{c}{NSBA}  \\
\hline
Function & Mean & SD & PR & Mean & SD & PR \\
\hline
$F_1 \ (N=50)$ & 1.0 & 0 & 5.89 \% & 6.8 & 0.7024 & 40.0 \% \\
\hline
$F_1 \ (N=100)$ & 1.0 & 0 & 5.89 \% & 7.267 & 0.5735 & 42.75 \% \\
\hline
$F_2 \ (N=100)$ & 1.0 & 0 & 0.87 \% & 7.9333 & 0.8929 & 6.56 \% \\
\hline
$F_2 \ (N=150)$ & 1.0 & 0 & 0.87 \% & 8.0667 & 0.7717 & 6.67 \% \\
\hline
\end{tabular}
\label{tab:nsba}
\end{center}
\end{table}

\begin{figure}[t]
\centering
\subfigure[$F_1 :(N=50)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f1_ba50.eps}
\label{fig:nsba-f1_ba50}}
\subfigure[$F_1 :(N=100)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f1_ba100.eps}
\label{fig:nsba-f1_ba100}}
\end{figure}

\begin{figure}[t]
\centering
\subfigure[$F_2 :(N=100)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f2_ba100.eps}
\label{fig:nsba-f2_ba100}}
\subfigure[$F_2 :(N=150)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f2_ba150.eps}
\label{fig:nsba-f2_ba150}}
\caption{BA}
\label{fig:nsba-results_ba}
\end{figure}

\begin{figure}[t]
\centering
\subfigure[$F_1 :(N=50)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f1_nsba50.eps}
\label{fig:nsba-f1_nsba50}}
\subfigure[$F_1 :(N=100)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f1_nsba100.eps}
\label{fig:nsba-f1_nsba100}}
\end{figure}

\begin{figure}[t]
\centering
\subfigure[$F_2 :(N=100)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f2_nsba100.eps}
\label{fig:nsba-f2_nsba100}}
\subfigure[$F_2 :(N=150)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f2_nsba150.eps}
\label{fig:nsba-f2_nsba150}}
\caption{NSBA}
\label{fig:nsba-results_nsba}
\end{figure}

\subsection{考察}
\label{ss:nsba-disc}

\subsubsection{個体数による影響}
個体数の変化による影響があるか調査するため，BAとNSBAにて個体数を変えて実験を行った．表\ref{tab:nsba}より，BAのPR値は$F_1$, $F_2$関数のいずれにおいても個体数による変化がなかった．一方，NSBAは個体数が増加すると2つの関数においてPR値が増加した．NSBAは$F_1$関数において，40\%から42.75\%と探索率が上昇し，$F_2$関数においても6.56\%から6.67\%と僅かに上昇した．このことから個体数を増やすことで探索性能が向上したと考えられる．また，図\ref{fig:nsba-all_iter}からも個体数の増加により，世代数が増す中でPR値を維持していることが分かる．$F_1$関数でNSBA($N=50$)のPR値は70\%から30\%へと低下しているが，NSBA($N=100$)では6000世代付近から50\%を維持していることが分かる．

\begin{figure}[t]
\centering
\subfigure[$F_1 :(N=50)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f1_n50.eps}
\label{fig:nsba-f1_n50}}
\subfigure[$F_1 :(N=100)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f1_n100.eps}
\label{fig:nsba-f1_n100}}
\end{figure}

\begin{figure}[t]
\centering
\subfigure[$F_2 :(N=100)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f2_n100.eps}
\label{fig:nsba-f2_n100}}
\subfigure[$F_2 :(N=150)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f2_n150.eps}
\label{fig:nsba-f2_n150}}
\caption{Convergence Speed of Peak Ratio implemented by BA and NSBA}
\label{fig:nsba-all_iter}
\end{figure}

\subsubsection{解の分布}
図\ref{fig:nsba-all_iter}よりPR値を維持できない原因を分析するため，ここではPR値が最も高かった1000世代目の解分布に着目し，その時の分布図を図\ref{fig:nsba-results_nsba_1000}に示す．この図から$F_1$関数において，NSBAは1000世代目ではほぼ全ての最適解及び局所解を探索することができているが，図\ref{fig:nsba-all_iter}から1000世代以降にPR値が低下している．これはNSBAの収束性能が強いために，一度発見した解よりも評価値の高い解を見つけた場合に移動してしまうことが原因であると考えられる．$F_2$関数においても同じような傾向が見られたが，$F_1$関数よりも多くの局所解が存在することから探索が困難となり，PR値は探索開始時から最終世代まで，20\%から10\%へと低いPR値であった．

\begin{figure}[t]
\centering
\subfigure[$F_1 :(N=50)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f1_n50_1000.eps}
\label{fig:nsba-f1_n50_1000}}
\subfigure[$F_1 :(N=100)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f1_n100_1000.eps}
\label{fig:nsba-f1_n100_1000}}
\end{figure}

\begin{figure}[t]
\centering
\subfigure[$F_2 :(N=100)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f2_n100_1000.eps}
\label{fig:nsba-f2_n100_1000}}
\subfigure[$F_2 :(N=150)$]{
\includegraphics[width=0.8\linewidth]{eps/IES2018/f2_n150_1000.eps}
\label{fig:nsba-f2_n150_1000}}
\caption{Distribution of Solutions (NSBA)}
\label{fig:nsba-results_nsba_1000}
\end{figure}

\FloatBarrier
\newpage
\section{Niche Radius-based Bat Algorithm (NRBA)}
\label{sec:NRBA}
探索空間の分割方法の一つとしてNiche Radiusが挙げられる．Niche Radiusは探索空間のスケールと探索する解の数を元に個体の探索範囲を決定することのできる手法である．これにより，各個体が同じ解に留まることなく分散させ，従来のBAに以下3つの変更点を加えることで，最適解だけでなく局所解も同時に探索可能なNRBA \cite{NRBA} を説明する．

\subsection{メカニズム}
\label{ss:NRBA-abst}
従来手法のBAからの変更点を以下の図\ref{fig:nr_tab}に表し，その詳細を以下に示す．
\begin{figure}[h]
  \centering
  \includegraphics[width=0.7\linewidth]{eps/nr_table.eps}
  \caption{BAからの変更点}
  \label{fig:nr_tab}
\end{figure}

\begin{itemize}
\item {\bf BAからの変更点1:大域探索} \\
ここではNiche Radiusを使用し，従来であるBAの解候補の生成式(\ref{eq:ba-vi}),(\ref{eq:ba-xi})を次式のように変更を加えた．
\begin{equation}
\label{eq:nrvi}
\mbox{\boldmath $v_i^{t+1}$}=\mbox{\boldmath $v_i^t$}+(\mbox{\boldmath $x_i^t$}-\mbox{\boldmath $x_{NR*}$})*f_i
\end{equation}
\begin{equation}
\label{eq:nrxi}
\mbox{\boldmath $x_i^{t+1}$}= \begin{cases}
\mbox{\boldmath $x_i^t$}+\mbox{\boldmath $v_i^{t+1}$} & ({\rm if} \ d_i^t < \sigma) \\
\mbox{\boldmath $x_i^t$} & ({\rm otherwise})
\end{cases}
\end{equation}
個体移動時のイメージ図を図\ref{fig:nr}に表す．各個体はNRを半径とした円の探索領域が決まっており，個体間距離${d_i}$がNRより小さい場合において，式(\ref{eq:nrvi})にてNR内の最良解${x_{NR*}}$を中心とした円から離れる方向へ個体${x_i^t}$が速度${v_i}$で移動する．またNR内に他の個体が存在しない，あるいは最良解$x_{NR*}$は移動をせず，その場所に留まる．この変更により，個体が同じ探索領域内に留まらず分散化をはかる．
\begin{figure}[h]
  \centering
  \includegraphics[width=0.7\linewidth]{eps/nr.eps}
  \caption{解候補の生成}
  \label{fig:nr}
\end{figure}

\item {\bf BAからの変更点2: 局所探索} \\
次に局所探索性能を上げるため，各個体が持つNiche Radius内の最良解${x_{NR*}}$の周辺に新しい解候補${x_{loc}}$を生成するよう変更した．生成式は次の通りである．
\begin{equation}
\label{eq:nrloc}
\mbox{\boldmath $x_{loc}$}=\mbox{\boldmath $x_{NR*}$} + \epsilon A_i^t
\end{equation}

$\epsilon$は1 $\times$ $D$次元の配列で$[-NR, \ NR]$区間のランダムな値が割り当てられる．この変更により，個体を局所解へ収束するよう促す．
\item {\bf BAからの変更点3: ランダム探索} \\
ランダム探索では各個体の持つNR内にランダムで解候補を以下の式のように生成する．
\begin{equation}
\label{eq:nrrnd}
\mbox{\boldmath $x_{rnd}$}=\mbox{\boldmath $x_i^t$} + rand(1,D,[-NR, NR])
\end{equation}
$[-NR, \ NR]$区間内の1×$D$次元の配列により現在位置$x_i^t$周辺に解候補を生成する．この変更では各個体を最適解あるいは局所解近辺へ移動させることで同じ場所に留まることを避ける．
\end{itemize}

\subsection{アルゴリズム}
\label{ss:NRBA-algorithm}
提案手法のNRBAのアルゴリズムの疑似コードをAlgorithm \ref{code:nrba}に記す．

\begin{itemize}
\item {\bf STEP1: 個体の初期化}\\
探索空間内にランダムに個体$x_i (i=1,2,...,N)$を生成し，周波数$f_i$，ラウドネス$A_i^0$，パルスレート$r_i^0$を決定する(1-3行目)．
\item {\bf STEP2: 速度の更新と解候補の生成}\\
速度$v_i$により新しく解候補を生成する(7行目)．
\item {\bf STEP3: 局所探索}\\
最良解$x_{pbest}$近辺に新しく解候補$x_{loc}$を生成する(10-11行目)．
\item {\bf STEP4: ランダム探索}\\
探索空間内にランダムで解候補$x_{rnd}$を生成する(12行目)．
\item {\bf STEP5: 評価と更新}\\
${\rm rand} < A_i$を満たす，かつ3つの解候補が$t$時点での最良解$x_{pbest}$よりも評価値が高ければ解を更新する(13-15行目)．
\item {\bf STEP6: STEP2へ戻る}\\
終了条件を満たすまでSTEP2へ戻る．
\end{itemize}

\begin{algorithm}[H]
\caption{Niche Radius-based Bat Algorithm (NRBA)}
\label{code:nrba}
\begin{algorithmic}[2]
\REQUIRE Objective\ Function\ $F(x)$
\STATE Initialize Population $x_i(i=1,2,..., N)$ and $v_i$\\
\STATE Define frequency $f_i$ at location $x_i$ [eq.(\ref{eq:freq})]
\STATE Initialize pulse rates $r_i$, and loudness $A_i$
\WHILE{($t <$ Max number of iterations)}
\FOR{i=1 to N}
\IF{$d_{ij} < NR$}
\STATE Generate a new solution $x_i$ and velocity $v_i$ [Eqs.(\ref{eq:nrvi}) to (\ref{eq:nrxi})]
\ENDIF
\IF{($rand>r_i$)}
\STATE Generate a new solution $x_{loc}$ around personal best solution $x_{NR*}$ in Niche radius [Eq.(\ref{eq:nrloc})] 
% \ELSE
% \STATE Continue
\ENDIF
\STATE Generate a new solution $x_{rnd}$ randomly in Niche radius [Eq.(\ref{eq:nrrnd})]
\IF{($rand<A_i \& \min (F(x_i), F(x_{loc}), F(x_{rnd})<F(x_{i*})$)}
\STATE Accept the new solution, and update pulse rate $r_i$ \\ \& loudness $A_i$ [Eqs. (\ref{eq:loud})(\ref{eq:pulse})]  
\ENDIF
\STATE Evaluate all bats and select a best solution $x_*$ in the current solutions
\ENDFOR
\STATE t=t+1
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\subsection{実験}
\label{ss:NRBA-exp}
最小化問題における最適解と局所解の数が異なる評価関数において，各手法の探索性能にどのような影響があるか調査する．次の4つのパターンの評価関数を用意し，従来手法であるBA，前章で提案したNSBAと比較することで提案手法の探索性能の有効性を検証する．一つの最適解に対して複数の局所解を持つ;複数の最適解に対して同じ数の局所解を持つ;一つの最適解の数に対して一つの局所解を持つ;最適解のみ複数持つ．これらのパターンに適した多峰性関数を用いて実験を行う．

\subsubsection{評価関数}
\label{sss:NRBA-func}
本実験で使用するベンチマーク関数は，\ref{ss:MinFunc}節で説明した$F_1$: Griewank，$F_3$: Six-Hump Camel，$F_4$: Michalewicz，$F_5$: Himmelblauの4つを用いる．

\subsubsection{評価基準}
\label{sss:NRBA-eval}
本実験において，Congress on Evolutionary Computation (CEC2013) \cite{CEC2013} のコンペティションで用いられた評価尺度であるPeak Ratio (PR) \cite{CDE} により評価する．評価式は以下のように設定した．
\begin{equation}
\label{eq:PR}
PR=\frac{\sum_{run=1}^{MR}FPs}{TP*MR}
\end{equation}
Max Run (MR) は実験回数を表し，Found Peaks (FPs) は発見した解の数を，Total Peak (TP) は探索領域内の全最適解及び局所解数を表す．また最適解及び局所解の位置座標と最近傍個体とのユークリッド距離が0.1未満であれば，その解を発見したと定義する．

\subsubsection{実験設定}
\label{sss:NRBA-setup}
個体数$N=50$とし，各個体のパラメータ$A_i^0=1$, $r_i^0 \in [0,\ 1]$，$f_{max}=1, f_{min}=0$, $\alpha = \gamma = 0.9$と設定した．またTable \ref{tab:minMOP}より，探索領域の上限$x_{ub}$と下限$x_{lb}$，各評価関数の解の総数$q$として使用した．また次元数$D=2$，世代数を10000，実験回数$MR=30$とした．

\subsubsection{実験結果}
\label{sss:NRBA-results}
各評価関数について，BAとNSBA，提案手法のNRBAにおけるPR値を表\ref{tab:nrba}に示す．表中のMean（平均値）とSD（標準偏差）は実験回数30回での最終世代における発見した最適解及び局所解数をPR値で表した結果である．各手法の最終世代での個体の分布を図 \ref{fig:results_ba}, \ref{fig:results_nrba}で表す．またグラフ中の赤い丸は個体の分布を示す．従来手法であるBAは全個体の最良解へ向かって進んでしまうため，全ての評価関数において，最適解あるいは評価値の高い局所解に収束した．しかし図\ref{fig:nrba-f4_ba}については局所解は存在しないが，最終世代では一つの最適解へ収束する結果となった．NSBAは全ての評価関数に対してBAよりもPR値が高く，特に局所解を含まない$F_5$関数においては全ての最適解を探索することが可能であった．一方で提案したNRBAは図\ref{fig:results_nrba}から全評価関数において，全ての解に個体が到達しているように分布しているが，表\ref{tab:nrba}から全体的にBAやNSBAよりも探索性能が高かったが，最適解や局所解の位置まで到達していないケースが多く見られた．また最適解や局所解に到達していない個体については用いた評価関数によって分布に偏りがあった．

\begin{figure}[t]
\centering
\subfigure[$F_1$: Griewank]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f1_ba.eps}
\label{fig:nrba-f1_ba}}
\subfigure[$F_3$: Six-Hump Camel]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f2_ba.eps}
\label{fig:nrba-f2_ba}}
\end{figure}

\begin{figure}[h]
\centering
\subfigure[$F_4$: Michalewicz]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f3_ba.eps}
\label{fig:nrba-f3_ba}}
\subfigure[$F_5$: Himmelblau]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f4_ba.eps}
\label{fig:nrba-f4_ba}}
\caption{BA}
\label{fig:results_ba}
\end{figure}


\begin{figure}[h]
\centering
\subfigure[$F_1$: Griewank]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f1_nsba.eps}
\label{fig:nrba-f1_nsba}}
\subfigure[$F_3$: Six-Hump Camel]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f2_nsba.eps}
\label{fig:nrba-f2_nsba}}
\end{figure}

\begin{figure}[h]
\centering
\subfigure[$F_4$: Michalewicz]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f3_nsba.eps}
\label{fig:nrba-f3_nsba}}
\subfigure[$F_5$: Himmelblau]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f4_nsba.eps}
\label{fig:nrba-f4_nsba}}
\caption{NSBA}
\label{fig:results_nsba}
\end{figure}


\begin{figure}[h]
\centering
\subfigure[$F_1$: Griewank]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f1_nrba.eps}
\label{fig:nrba-f1_nrba}}
\subfigure[$F_3$: Six-Hump Camel]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f2_nrba.eps}
\label{fig:nrba-f2_nrba}}
\end{figure}

\begin{figure}[h]
\centering
\subfigure[$F_4$: Michalewicz]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f3_nrba.eps}
\label{fig:nrba-f3_nrba}}
\subfigure[$F_5$: Himmelblau]{
\includegraphics[width=0.9\linewidth]{eps/SICESSI2018/f4_nrba.eps}
\label{fig:nrba-f4_nrba}}
\caption{NRBA}
\label{fig:results_nrba}
\end{figure}

\begin{table}[h]
\caption{The value of PR (averaged over 30 runs)}
\begin{center}
\begin{tabular}{c|c|c|c}
\hline
\multicolumn{1}{c|}{} & \multicolumn{1}{c|}{BA} & \multicolumn{1}{c|}{NSBA} & \multicolumn{1}{c}{NRBA}  \\
\hline
Function & Mean $\pm$ SD  & Mean $\pm$ SD &  Mean $\pm$ SD \\
\hline
$F_1$ & 0.0588 $\pm$ 0 & 0.3760 $\pm$ 0.0413 & {\bf 0.6922} $\pm$ 0.0981  \\
\hline
$F_3$ & 0.4917 $\pm$ 0.0449 & 0.5 $\pm$ 0 & {\bf 0.9917} $\pm$ 0.0449 \\
\hline
$F_4$ & 0.5 $\pm$ 0 & 0.5 $\pm$ 0 & {\bf 0.7} $\pm$ 0.2450 \\
\hline
$F_5$ & 0.2417 $\pm$ 0.1367 & {\bf 1} $\pm$ 0 & 0.8583 $\pm$ 0.1239 \\
\hline
\end{tabular}
\label{tab:nrba}
\end{center}
\end{table}

\subsection{考察}
\label{ss:nrba-disc}
全体的に，BAやNSBAより提案のNRBAのほうが探索した解の数および発見率が高かったことから最適解への収束を防ぎ，複数の局所解へ分散させることができた．また提案手法の探索性能の有効性を確かめるため，評価尺度による解の発見数及び発見率の結果と，最終世代の解の分布という観点から分析を行った．


\subsubsection{解の発見数}
\label{sss:nrba-pr} 
表\ref{tab:nrba}から従来手法のBAは全ての評価関数において一つの解へ収束する傾向が強かったが，$F_2$関数では2つの解を探索することができた．これは従来手法のアルゴリズムの解候補の生成において，全個体の最良解へ向かって探索をしていることが原因であると考えられる．NSBAについても同様，収束性能が高いために，同じ局所解に複数の個体が密集していることが確認できたが，$F_4$関数においては全ての最適解に到達することが可能であった．これは，最適解の評価値が全て均一であったため，結果として一つの最適解に留まらなかったと考えられる．提案手法のNRBAは全ての評価関数に対して，従来手法よりも発見した解の数が多く，最適解と複数の局所解を探索することができた．評価関数の中でも$F_2$関数，次いで$F_4$関数のPRの値が高いことから最適解のみ存在する場合と，最適解と局所解の評価値の差が小さい場合において提案手法の探索が有効に働いたと考えられる．また局所解を多く含む$F_1$関数や局所解の範囲が非常に狭い$F_3$関数では探索性能が落ちたことから今後の課題として手法を改良する必要がある．

\subsubsection{最終世代における解の分布}
\label{sss:dstr_sol} 
図\ref{fig:results_ba}から従来のBAは，最適解への収束が非常に強かった．しかし，図\ref{fig:nrba-f2_ba}では2つの最適解に収束していたものの，図\ref{fig:nrba-f4_ba}では複数の最適解へ収束することなく一つの最適解へ収束した．これは，$F_4$関数の方が探索領域が広く，評価値の数値の範囲も広いことから各個体の持つ評価値にバラつきが出やすく，一つの最適解へ収束したと考えられる．図\ref{fig:results_nrba}より提案手法のNRBAは，図\ref{fig:nrba-f1_nrba}では色濃度の濃い領域に各個体を分散させることができたが，図\ref{fig:nrba-f2_nrba}, \ref{fig:nrba-f3_nrba}, \ref{fig:nrba-f4_nrba}では最適解や局所解でない場所に分布する個体も多く見られた．このことから従来手法から変更した，Niche Radius内の最良解より個体が遠ざかる機構が働いたと考えられる．以上より探索領域を分割し，各個体の探索領域内での大域探索性能を保ちながらも徐々に局所解へ収束させることが，解の発見率の増加に繋がったと考えられる．


\clearpage
\newpage
\section{Dynamic Niche Radius-based Bat Algorithm (DNRBA)}
\label{sec:DNRBA}
本章では，NRBAで局所解に収束しなかった個体を最適解や局所解へ移動させることで，収束性能を高めることを目的としたDynamic Niche RadiusをBAに適用させたDNRBAを提案する．BA空の変更点を図\ref{fig:dnr_tab}に示す．
\subsection{メカニズム}
\label{ss:DNRBA-abst}

\begin{figure}[h]
\centering
\includegraphics[width=0.7\linewidth]{eps/dnrba_table.eps}
\label{fig:dnr_tab}
\caption{BAからの変更点}
\end{figure}

\ref{ss:dns}節で説明したDynamic Niche Sharing \cite{DNS} より，探索領域に属する個体が同じ局所解に収束することを避けるため，本研究では以下の変更を加えた．
\begin{equation}
\label{eq:mi}
m_i^{dyn}=\begin{cases}
\sigma & ({\rm if } \ m_i < \sigma) \\
m_i & ({\rm otherwise})
\end{cases}
\end{equation}

\begin{equation}
\label{eq:dnrba-vi}
 \mbox{\boldmath $v_i^{t+1}$} = \mbox{\boldmath $v_i^t$} + (\mbox{\boldmath $x_i^t$}-\mbox{\boldmath $x_{NR*}$})*f_i
\end{equation}
$v_i$，$x_i$は個体の速度と位置を表し，$x_{NR*}$は$x_i$が属するNiche Radius内の最良個体を示す．
(\ref{eq:mi})式に基づいて，個体の更新式は以下で表される．
\begin{equation}
\label{eq:dnrba-xi}
\mbox{\boldmath $x_i^{t+1}$}=\begin{cases}
\mbox{\boldmath $x_i^t$}+\mbox{\boldmath $v_i^{t+1}$} & ({\rm if} \ m_i < \sigma) \\
\mbox{\boldmath $x_i^t$} & ({\rm otherwise})
\end{cases}
\end{equation}
ここでは個体の分布密度が高いほど，個体$x_i$の持つNiche Count $m_i$の範囲内にある最良個体$x_{NR*}$から遠ざかる方向へ新たに解候補を生成する．探索範囲決定のイメージ図\ref{fig:dnr}に示す．

\begin{figure}[h]
\centering
\includegraphics[width=0.7\linewidth]{eps/dynamic_niche_radius.eps}
\label{fig:dnr}
\caption{Dynamic Niche Radiusのイメージ図}
\end{figure}

局所探索では(\ref{eq:mi})式で算出した最良個体$x_{NR*}$が持つ$m_i$の範囲内で個体$x_i$が新たに解候補$x_{loc}$を生成する．
\begin{equation}
\label{eq:dnrloc}
\mbox{\boldmath $x_{loc}$}=\mbox{\boldmath $x_{NR*}$} + A_i^t*rand(1,D,[-m_i, m_i])
\end{equation}
ランダム探索では，個体$x_i$の持つ$m_i$の範囲内で新たに解候補$x_{rnd}$を生成することで，局所解への収束性能を高める．生成式は次式で表される．
\begin{equation}
\label{eq:dnrrnd}
\mbox{\boldmath $x_{rnd}$}=\mbox{\boldmath $x_i^t$} + rand(1,D,[-m_i, m_i])
\end{equation}

\subsection{アルゴリズム}
\label{sss:DNRBA-algorithm}
DNRBAのアルゴリズムの疑似コードを以下のAlgorithm \ref{code:dnr}, \ref{code:dnrba}に記す．

\begin{itemize}
\item {\bf STEP1: 個体の初期化}\\
探索空間内にランダムに個体$x_i (i=1,2,...,N)$を生成し，周波数$f_i$，ラウドネス$A_i^0$，パルスレート$r_i^0$を決定する(1-3行目)．
\item {\bf STEP2: Dynamic Niche Radius算出}\\
Algorithm \ref{code:dnr}により，各個体の持つniche count $m_i$を算出する(5行目)．
\item {\bf STEP3: 速度の更新と解候補の生成}\\
速度$v_i$により新しく解候補を生成する(8行目)．
\item {\bf STEP4: 局所探索}\\
最良解$x_{pbest}$近辺に新しく解候補$x_{loc}$を生成する(10-11行目)．
\item {\bf STEP5: ランダム探索}\\
探索空間内にランダムで解候補$x_{rnd}$を生成する(13行目)．
\item {\bf STEP6: 評価と更新}\\
${\rm rand} < A_i$を満たす，かつ3つの解候補が$t$時点での最良解$x_{pbest}$よりも評価値が高ければ解を更新する(14-16行目)．
\item {\bf STEP6: STEP2へ戻る}\\
終了条件を満たすまでSTEP2へ戻る．
\end{itemize}

\begin{algorithm}[h]
\caption{Dynamic Niche Radius}
\label{code:dnr}
\begin{algorithmic}[2]
\REQUIRE Current Population $x_i(i=1,2,..., N)$ and $v_i$
\FOR{i=1 to N}
\FOR{j=1 to N}
\STATE Calculate $d_{ij}$ between individuals $i,j$
\IF{( $d_{ij} < \sigma$)}
\STATE $sh(d_{ij}) =  (1-\frac{d_{ij}}{\sigma})$ [Eq.(\ref{eq:sfunc})]
\ELSE
\STATE $sh(d_{ij}) =  0 $ [Eq.(\ref{eq:sfunc})]
\ENDIF
\ENDFOR
\STATE $m_i=\sum_{j=1}^N sh(d_{ij})$ [Eq.(\ref{eq:nc})]
\ENDFOR
\FOR{i=1 to N}
\IF{$(m_i < \sigma)$}
\STATE $m_i^{dyn}=\sigma$ [Eq.(\ref{eq:mi})]
\ELSE 
\STATE $m_i^{dyn} = m_i$ [Eq.(\ref{eq:mi})]
\ENDIF
\ENDFOR
\RETURN Dynamic Niche Radius $m_i^{dyn}$
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[h]
\caption{Bat Algorithm with Dynamic Niche Radius (DNRBA)}
\label{code:dnrba}
\begin{algorithmic}[3]
\REQUIRE Objective\ Function\ $F(x)$
\STATE Initialize Population $x_i(i=1,2,..., N)$ and $v_i$\\
\STATE Define frequency $f_i$ at location $x_i$ [Eq.(\ref{eq:freq})]
\STATE Initialize pulse rates $r_i$, and loudness $A_i$
\WHILE{($t <$ Max number of iterations)}
\STATE Calculate Dynamic Niche Radius (Algorithm 2)
\FOR{i=1 to N}
\IF{$d_{ij} < \sigma$}
\STATE Generate a new solution $x_i$ and velocity $v_i$ [Eqs.(\ref{eq:dnrba-vi}) and (\ref{eq:dnrba-xi})]
\ENDIF
\IF{($rand>r_i$)}
\STATE Generate a new solution $x_{loc}$ around personal best solution $x_{NR*}$ in Niche radius [Eq.(\ref{eq:dnrloc})] 
% \ELSE
% \STATE Continue
\ENDIF
\STATE Generate a new solution $x_{rnd}$ randomly in Niche radius [Eq.(\ref{eq:dnrrnd})]
\IF{($rand<A_i \& \min (F(x_i), F(x_{loc}), F(x_{rnd})<F(x_{i*})$)}
\STATE Accept the new solution, and update pulse rate $r_i$ \\ \& loudness $A_i$ [Eqs. (\ref{eq:loud}) and (\ref{eq:pulse})]  
\ENDIF
\STATE Evaluate all bats and select a best solution $x_*$ in the current solutions
\ENDFOR
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\subsection{実験}
\label{ss:DNRBA-exp}
DNRBAの収束性能を検証するため，ここではBAと比較する．本実験では最小化問題における，最適解と局所解を持つGriewank関数とShubert関数を用いた．

\subsubsection{評価関数}
\label{sss:DNRBA-func}
本実験では，評価関数は\ref{ss:MinFunc}節で説明した$F_1$, $F_6$関数を使用する．

% \begin{description}
% \item[$F_1$: Griewank Function]\mbox{}\\
% Griewank関数の概形を図\ref{fig:dnrba-f1}に示す.
% \begin{equation}
% F_1(x)= \sum_{i=1}^D \frac{x_{i}}{4000} - \prod_{i=1}^D \cos(\frac{x_i}{\sqrt{i}}) + 1,
% \label{eq:dnrba-f1}
% \end{equation}
% 最適解の評価値は${F(x_*)}=0$であり，1つの最適解と16個の局所解を持つ．探索範囲は$x_1, x_2 \in [-10, \ 10]$である.

% % \begin{figure}[h]
% % \centering
% % \subfigure[Fitness landscape]{
% % \includegraphics[width=0.8\linewidth]{eps/ISMSI2019/3d_griewank.eps}
% % \label{fig:3df1}}
% % \subfigure[Contour plot]{
% % \includegraphics[width=0.8\linewidth]{eps/ISMSI2019/cont_griewank.eps}
% % \label{fig:cf1}}

% % \caption{$F_1$: Griewank Function}
% % \label{fig:dnrba-f1}
% % \end{figure}

% \item[$F_2$: Shubert Function]\mbox{}\\
% Shubert関数の概形を図\ref{fig:dnrba-f2}に示す.
%  \begin{equation}
% F_2(x) = \prod_{i=1}^D \sum_{j=1}^5 j \cos[(j+1)x_i+j], 
% \end{equation}
% $D$は次元数を表し，最適解の評価値は${F(x_*)=-187.731}$である.この関数では$D \cdot 3^D $個の最適解のみ存在し，2次元では18個の最適解を持つ．探索範囲は$x_i \in [-10, 10]^D$ $(i=1,2,...,D)$である.

% \begin{figure}[h]
% \centering
% \subfigure[Fitness landscape]{
% \includegraphics[width=0.8\linewidth]{eps/ISMSI2019/3d_shubert.eps}
% \label{fig:3df2}}
% \subfigure[Contour plot]{
% \includegraphics[width=0.8\linewidth]{eps/ISMSI2019/cont_shubert.eps}
% \label{fig:cf2}}

% \caption{$F_2$: Shubert Function}
% \label{fig:dnrba-f2}
% \end{figure}

% \end{description}


\subsubsection{評価基準}
\label{sss:DNRBA-eval}

\subsubsection{Peak Ratio}
本実験ではCEC2013　Competitionで用いられたPeak Ratio (PR) \cite{CEC2013} を用い，発見した解の数の割合を求める．PRの算出式は次式で表される．
\begin{equation}
PR=\frac{\sum_{run=1}^{MR}FPs}{TP*MR}
\end{equation}
Max Run (MR) は実験回数を表し，Found Peaks (FPs) は発見した解の数を，Total Peak (TP) は探索領域内の全最適解及び局所解数を表す．また最適解及び局所解の位置座標と最近傍個体とのユークリッド距離が0.1未満であれば，その解を発見したと定義する．

\subsubsection{Peak Accuracy}
探索する個体が最適解にどのくらい近づいているかを計測する尺度としてPeak Accuracy (PA) \cite{CEC2013} を用いる．PAの算出式は以下で表される．
\begin{equation}
PA=\sum_{j=1}^{TP}|F(s_j)-F(x_{NN_j})|,
\end{equation}
この時，$F(s_j)$は$j$番目の最適解の評価値を表し，その最近傍個体$x_{NN_j}$の評価値との差分和を求める．則ち，PA値が0に近づくほど，個体が最適解に位置していることを示す．

\FloatBarrier
\subsection{実験設定}
本実験では$f_{max}=1$, $f_{min}=0$，ラウドネス$A^0=1$，パルスレート$r^0 \in [0,1]$と設定した．また$\alpha= \gamma = 0.9$とし，個体数を100，世代数を30000としてランダムシードを変えた実験を30回行った．

\subsection{実験結果と考察}
\label{sss:DNRBA-results}
本節ではDNRBAの性能の効果を確かめるため，各評価関数におけるPRとPAに着目する．表\ref{tab:dnrba-1}, \ref{tab:dnrba-2}は，BAとDNRBAのアルゴリズムにおけるPRとPAの結果を表す．各評価関数のPRとPAの30試行の平均値及び標準偏差を示している．また図\ref{fig:dnrba-results_ba}，\ref{fig:dnrba-results_dnrba}は最終世代の個体の分布を白い丸で表す．

\begin{table}[h]
\caption{PR and PA of BA and DNRBA (averaged over 30 runs)}
\begin{center}
\begin{tabular}{c|c|c|c|c}
\multicolumn{5}{c}{$\varepsilon = 1.0E-1$} \\
\hline
\multicolumn{1}{c|}{} & \multicolumn{2}{c|}{BA} & \multicolumn{2}{c}{DNRBA} \\
\hline
 & PR & PA & PR & PA \\

Function & (Mean and SD) & (Mean and SD) & (Mean and SD) & (Mean and SD) \\
\hline
$F_1 $ & 0.2725 $\pm$ 0.0598 & 0.2416 $\pm$ 0.0149 & {\bf 0.9373} $\pm$ 0.1176  & {\bf 0.0094} $\pm$ 0.0155  \\
\hline
$F_6 $ & {\bf 0.4889} $\pm$ 0.1819 & {\bf 1.8160} $\pm$ 0.4990 & 0.4241 $\pm$ 0.388 & 2.4123 $\pm$ 0.6780 \\
\hline

\end{tabular}
\label{tab:dnrba-1}
\end{center}
\end{table}

\begin{table}[h]
\caption{PR and PA of BA and DNRBA (averaged over 30 runs)}
\begin{center}
\begin{tabular}{c|c|c|c|c}
\multicolumn{5}{c}{$\varepsilon = 1.0E-2$} \\
\hline
\multicolumn{1}{c|}{} & \multicolumn{2}{c|}{BA} & \multicolumn{2}{c}{DNRBA} \\
\hline
 & PR & PA & PR & PA \\

Function & (Mean and SD) & (Mean and SD) & (Mean and SD) & (Mean and SD) \\
\hline
$F_1 $ & 0.2725 $\pm$ 0.0608 & 0.2416 $\pm$ 0.0151 & {\bf 0.9373} $\pm$ 0.1176  & {\bf 0.0094} $\pm$ 0.0155  \\
\hline
$F_6 $ & {\bf 0.0556} $\pm$ 0.0619 & {\bf 1.8160} $\pm$ 0.4990 & 0.0426 $\pm$ 0.0477 & 2.4123 $\pm$ 0.6780 \\
\hline

\end{tabular}
\label{tab:dnrba-2}
\end{center}
\end{table}

\subsubsection{Peak Ratio}
表\ref{tab:dnrba-1}より$\varepsilon=1.0E-1$の$F_1$関数では，BAよりもDNRBAのPR値の方が高く，図\ref{fig:dnrba-f1dnrba}からほぼ全ての最適解と局所解を発見していることが分かる．対して$F_6$関数では，図\ref{fig:dnrba-f2ba}，\ref{fig:dnrba-f2dnrba}から個体が全最適解に位置しているように見て取れるが，DNRBAよりもBAの方が僅かにPR値が高かった．このことから最適解しか存在しない関数についてはBAのほうが探索性能則ち収束性能が高いことが分かった．$\varepsilon=1.0E-2$についても同様，PR値は$F_1$関数はDNRBAの方が高く，$F_6$関数ではBAの方が高かった．

\subsubsection{Peak Accuracy}
表\ref{tab:dnrba-1}, \ref{tab:dnrba-2}から$F_1$関数では，BAよりDNRBAの方がPA値が高かったが，$F_6$関数ではBAの方がPA値が高かった．これは，従来BAの収束する方向へ解候補を生成する機構が働いていることが一つの要因として考えられる．加えてランダム探索において，探索空間内に解候補を生成することでPA値がより良くなったと考えられる．

\begin{figure}[h]
\centering
\subfigure[$F_1$]{
\includegraphics[width=0.8\linewidth]{eps/ISMSI2019/f1_ba.eps}
\label{fig:dnrba-f1ba}}
\subfigure[$F_6$]{
\includegraphics[width=0.8\linewidth]{eps/ISMSI2019/f2_ba.eps}
\label{fig:dnrba-f2ba}}

\caption{BA}
\label{fig:dnrba-results_ba}
\end{figure}

\begin{figure}[h]
\centering
\subfigure[$F_1$]{
\includegraphics[width=0.8\linewidth]{eps/ISMSI2019/f1_nrba.eps}
\label{fig:dnrba-f1nrba}}
\subfigure[$F_6$]{
\includegraphics[width=0.8\linewidth]{eps/ISMSI2019/f2_nrba.eps}
\label{fig:dnrba-f2nrba}}

\caption{NRBA}
\label{fig:dnrba-results_nrba}
\end{figure}

\begin{figure}[t]
\centering
\subfigure[$F_1$]{
\includegraphics[width=0.8\linewidth]{eps/ISMSI2019/f1_dnrba.eps}
\label{fig:dnrba-f1dnrba}}
\subfigure[$F_6$]{
\includegraphics[width=0.8\linewidth]{eps/ISMSI2019/f2_dnrba.eps}
\label{fig:dnrba-f2dnrba}}

\caption{DNRBA}
\label{fig:dnrba-results_dnrba}
\end{figure}

% \subsection{まとめ}

\FloatBarrier
\newpage
\section{他の最先端手法との性能比較実験}
\label{sec:experiment}
本章では他の最先端手法と探索性能を比較するため，複数解探索手法のコンペティション(CEC 2013 Competition)で使用された手法に着目する．実験環境をCEC 2013 Competitionで用いられた評価関数，評価指標に合わせて実験を行った．

% \subsection{複数解探索における多峰性最適化問題}
% \label{ss:cec2013}
% 本実験では，複数最適解を探索する手法の性能を比較するため，CEC ({\it IEEE Congress on Evolutionary Computation}) 2013 Competition on Niching Methods for Multimodal Function Optimization \cite{CEC2013} で扱われたベンチマーク関数を用いる．使用する関数について,次節で説明する．

\subsection{評価関数}
% \label{sss:benchmark}

% \subsection{最大化問題における評価関数}
\label{ss:maxFunc}
本実験では，複数最適解を探索する手法の性能を比較するため，CEC 2013 Competitionで扱われたベンチマーク関数を説明する．本コンペティションでは評価値が同じである複数最適解のみ探索することを目的としている．ベンチマーク関数の最適解の評価値$F(x_*)$と最適解数，探索領域，閾値$\rho$ (次節で説明)を表\ref{tab:maxMOP}に示す．
\begin{description}
\item[$G_1$: Five-Uneven-Peak Trap (1D)]\mbox{}\\
\begin{equation}
\label{eq:maxF1}
G_1(x)=\begin{cases}
80(2.5-x) & {\rm for} \ 0 \leq x < 2.5, \\
64(x-2.5) & {\rm for} \ 2.5 \leq x < 5.0, \\
64(7.5-x) & {\rm for} \ 5.0 \leq x < 7.5, \\
28(x-7.5) & {\rm for} \ 7.5 \leq x < 12.5, \\
28(17.5-x) & {\rm for} \ 12.5 \leq x < 17.5, \\
32(x-17.5) & {\rm for} \ 17.5 \leq x < 22.5, \\
32(27.5-x) & {\rm for} \ 22.5 \leq x < 27.5, \\
80(x-27.5) & {\rm for} \ 27.5 \leq x < 30.
\end{cases}
\end{equation}
\begin{figure}[h]
\centering
\includegraphics[width=0.8\linewidth]{eps/F1.eps}
\caption{Five-Uneven-Peak Trap}
\label{fig:maxF1}
\end{figure}

\item[$G_2$: Equal Maxima (1D)]\mbox{}\\
\begin{equation}
\label{eq:maxF2}
G_2(x)=\sin^6{(5\pi x)}.
\end{equation}
\begin{figure}[h]
\centering
\includegraphics[width=0.8\linewidth]{eps/F2.eps}
\caption{Equal Maxima}
\label{fig:maxF2}
\end{figure}

\item[$G_3$: Uneven Decreasing Maxima (1D)]\mbox{}\\
\begin{equation}
\label{eq:maxF3}
G_3(x)=exp(-2log(2)(\frac{x-0.08}{0.854})^2)\sin^6{(5\pi(x^{\frac{3}{4}}-0.05))}.
\end{equation}
\begin{figure}[h]
\centering
\includegraphics[width=0.8\linewidth]{eps/F3.eps}
\caption{Uneven Decreasing Maxima}
\label{fig:maxF3}
\end{figure}

\item[$G_4$: Himmelblau (2D)]\mbox{}\\
\begin{equation}
\label{eq:maxF4}
G_4(x,y) = 200 - (x^2+y-11)^2 - (x+y^2-7)^2.
\end{equation}
\begin{figure}[h]
\centering
\includegraphics[width=0.8\linewidth]{eps/F4.eps}
\caption{2D Himmelblau}
\label{fig:maxF4}
\end{figure}

\item[$G_5$: Six-Hump Camel Back (2D)]\mbox{}\\
\begin{equation}
\label{eq:maxF5}
G_5(x,y)=-4[(4-2.1x^2+\frac{x^4}{3})x^2+xy+(4y^2-4)y^2].
\end{equation}
\begin{figure}[h]
\centering
\includegraphics[width=0.8\linewidth]{eps/F5.eps}
\caption{2D Six-Hump Camel Back}
\label{fig:maxF5}
\end{figure}

\item[$G_6$: Shubert (2D)]\mbox{}\\
\begin{equation}
\label{eq:maxF6}
G_6(x)=-\prod_{i=1}^D \sum_{j=1}^5 j\cos[(j+1)x_i+j].
\end{equation}
\begin{figure}[h]
\centering
\includegraphics[width=0.8\linewidth]{eps/F6.eps}
\caption{2D Shubert}
\label{fig:maxF6}
\end{figure}

\end{description}

\begin{table}[h]
\caption{Benchmark Test Functions}
\begin{center}
\begin{tabular}{c|c|c|c|c|c}
\hline

Function & $G(x_*)$ & Num of & $\rho$ & $D$ & Search Range \\
& & global optima & & & \\
\hline
$G_1$ & 200.0 & 2 & 0.01 & 1 & $x \in [0,30]$  \\
\hline
$G_2$ & 1.0 & 5 & 0.01 & 1 & $x \in [0,1]$  \\
\hline
$G_3$ & 1.0 & 1 & 0.01 & 1 & $x \in [0,1]$  \\
\hline
$G_4$ & 200.0 & 4 & 0.01 & 2 & $x,y \in [-6,6]$  \\
\hline
$G_5$ & 1.03163 & 2 & 0.5 & 2 & $x \in [-1.9,1.9]$, \\
& & & & & $y \in [-1.1,1.1]$ \\
\hline
$G_6$ & 186.731 & 18 & 0.5 & 2 & $x_i \in [-10,10]$  \\
\hline
% \multicolumn{4}{l}{$^{\mathrm{a}}$Sample of a Table footnote.}
\end{tabular}
\label{tab:maxMOP}
\end{center}
\end{table}

\FloatBarrier

\subsection{評価基準}
\label{ss:eval_criteria}
本コンペティションではPR \cite{CEC2013} によりアルゴリズムの性能評価を行う．各評価関数で割り当てられた評価回数 (MaxFEs) と accuracy level $\varepsilon$を用いてPRは次式で表される．
\begin{equation}
\label{eq:PR}
PR=\frac{\sum_{run=1}^{NR}NPF_{run}}{NKP*NR}
\end{equation}
$NPF_{run}$は，そのシードにおけるアルゴリズムが発見した最適解数を示し，NKPは評価関数が持つ全最適解数を示す．NRは実験の試行回数を示す．最適解を発見する定義は以下のAlgorithm \ref{code:foptima}により決定される．

\begin{algorithm}[H]
\caption{Calculate how many global optima the algorithm found}
\label{code:foptima}
\begin{algorithmic}[2]
\REQUIRE $L_{sorted}$ a list of individuals in descending order of the fitness value
\STATE $S = \emptyset$
\WHILE{($not \ reaching \ the \ end \ of \ L_{sorted}$)}
\STATE Get best unprocessed $p \in L_{sorted}$;
\STATE $found \leftarrow$ FALSE;
\IF{$d(ph, fit(p))\leq \varepsilon$}
\FOR{$all \ s \in S$}
\IF{$d(s,p) \leq \rho$}
\STATE $found \leftarrow$ TRUE;
\STATE break;
\ENDIF
\ENDFOR
\IF{not found}
\STATE let $s \leftarrow S \cup \{p\}$
\ENDIF
\ENDIF
\ENDWHILE
\end{algorithmic}
\end{algorithm}

\begin{itemize}
	\item {\bf 個体を評価値で降順にソート (1行目)}\\
	\item {\bf 最適解と個体の評価値の差分に基づいて解発見を定義 (2-16行目)}\\
	最適解と個体の持つ評価値の差分が accuracy level $\varepsilon$未満である(5行目)，かつ最近傍個体同士の距離が閾値$\rho$未満(7行目)であれば，評価値の良い最近傍個体のみ残し，それ以外の個体を削除する．残った個体数が最適解を発見した数とする(8行目)．
\end{itemize}
\FloatBarrier

\subsection{比較手法}
\ref{sec:MA}, \ref{sec:nm}章で紹介したDEやCMA-ES, NSGAII, CDE, dADE, NEAに加え，本コンペティションでは次の手法 \cite{PNA-NSGA} \cite{DEs} \cite{N-VMO} と比較実験を行った．

\subsection{実験設定}
本実験では$f_{max}=1$, $f_{min}=0$，ラウドネス$A^0=1$，パルスレート$r^0 \in [0,1]$と設定した．また$\alpha= \gamma = 0.9$とし，個体数$N=100$，世代数を$G_1$から$G_5$までは50000, $G_6$は200000とし，ランダムシードを変えた実験を50回行った．

\subsection{結果と考察}
\label{ss:results}
図\ref{fig:resutls_comp_E1}から\ref{fig:resutls_comp_E5}はaccuracy level $\varepsilon$を変えた時のPR値をヒートマップ化したものである．$\varepsilon = 1.0E-1$では$G_1$から$G_5$関数まではNSGAIIやIPOP-CMA-ES，NSBAの探索性能が低いことが分かる．特に$G_6$関数において，IPOP-CMA-ESとNSBAが最もPR値が低く，次いでNSGAII，DE/nrand/1，NRBAが低かった．提案した3つの手法の中ではDNRBAが最もPR値が高かったが，$\varepsilon = 1.0E-2$ではNRBAとDNRBAはほぼ同等の探索性能であり，$\varepsilon=1.0E-3$では$G_4$関数においてNRBAの方がPR値が高かった．$\varepsilon=1.0E-4$では$G_4$，$G_5$関数でDNRBAよりもNRBAの方がPR値が高く，$\varepsilon = 1.0E-5$では全ての関数においてNRBAよりもDNRBAの方がPR値が高かった．また，表\ref{tab:MOP_results}は全ての関数におけるPR値の中央値と，平均及び標準偏差を示す．この結果から，提案手法の一つであるNSBAは最も探索性能が悪かったが，NRBA，次いでDNRBAは他の手法とほぼ同等の探索性能を示すことが可能であった．この結果から，全体的にNRBAの方が探索性能が高かったが，$G_6$関数のような最適解周辺の勾配が激しく難しい問題に対してはDNRBAのほうが有効であった．

\begin{table}[b]
\caption{Overall Performance of the PR value (averaged over 50 runs)}
\begin{center}
\begin{tabular}{c|c|c|c}
\hline

Algorithm & Median & Mean & St.D  \\

\hline
NSGAII & 0.9350 & 0.7274 & 0.0646 \\
\hline
CMA-ES & 1.0 & 0.9371 & 0.1423 \\
\hline
CDE & 1.0 & 0.8229 & 0.2087 \\
\hline
dADE/nrand/1 & 1.0 & 0.9663 & 0.1820 \\
\hline
dADE/nrand/2 & 1.0 & 0.9611 & 0.1774 \\
\hline
DECG & 1.0 & 0.9662 & 0.1820 \\
\hline
DELG & 1.0 & 0.9658 & 0.1814 \\
\hline
DELS-aj & 1.0 & 0.9666 & 0.1825 \\
\hline
DE/nrand/1 & 1.0 & 0.8919 & 0.0801 \\
\hline
DE/nrand/2 & 1.0 & 0.9225 & 0.1221 \\
\hline
IPOP-CMA-ES & 0.7760 & 0.7240 & 0.0162 \\
\hline
NEA1 & 1.0 & 0.9166 & 0.1142 \\
\hline
NEA2 & 1.0 & 0.9608 & 0.1747 \\
\hline
N-VMO & 1.0 & 0.9540 & 0.1738 \\
\hline
PNA-NSGAII & 1.0 & 0.8960 & 0.0929 \\
\hline
NSBA & 0.1850 & 0.3358 & 0.0384 \\
\hline
NRBA & 0.9520 & 0.7659 & 0.1165 \\
\hline
DNRBA & 0.9070 & 0.7540 & 0.1519 \\
\hline

\end{tabular}
\label{tab:MOP_results}
\end{center}
\end{table}


\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{eps/E-1.eps}
\caption{$\varepsilon = 1.0E-1$}
\label{fig:resutls_comp_E1}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{eps/E-2.eps}
\caption{$\varepsilon = 1.0E-2$}
\label{fig:resutls_comp_E2}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{eps/E-3.eps}
\caption{$\varepsilon = 1.0E-3$}
\label{fig:resutls_comp_E3}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{eps/E-4.eps}
\caption{$\varepsilon = 1.0E-4$}
\label{fig:resutls_comp_E4}
\end{figure}
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{eps/E-5.eps}
\caption{$\varepsilon = 1.0E-5$}
\label{fig:resutls_comp_E5}
\end{figure}


\FloatBarrier


\clearpage
\section{おわりに}
\label{sec:END}
この章では本論文のまとめを\ref{sec:END}節で行い, 今後の課題を\ref{ss:END_future}節で行う.

\subsection{まとめ}
\label{ss:Conclusion}
本論文では，多峰性最適化問題における複数解探索手法のアプローチとして3つの解探索手法を提案した．(i) 未探索領域へ解の探索を促すNovelty Searchを導入したNovelty Search-based Bat Algorithm (NSBA); (ii) 探索空間の大きさと最適解数から算出される Niche Radius を用いることで，予め各個体の探索領域を決定し，その探索領域内の最良個体から遠ざかる方向に移動させることによって，個体同士を同じ解に留まらせないNiche Radius-based Bat Algorithm (NRBA); (iii) 探索領域を動的に変更することで，NRBAの効果を高めたBat Algorithm with Dynamic Niche Radius (DNRBA)．提案手法の有効性を検証するため，CEC2013 Competition on Niching Methods for Multimodal Function Optimizationで扱われた評価関数を用いて，他の最先端手法との比較実験を行った．実験の結果として，複雑な多峰性を持つ関数においてはDNRBAの方が探索性能が高いが，一般的にはNRBAのほうが探索性能が高かった．これは，局所解へ陥ってしまった個体を最適解へ移動させる機構を持つDynamic Niche Radiusが複雑な関数においては有効だが，容易な問題に対しては局所解へ陥ることがないため，NRBAの方が有効であったと考えられる．



\subsection{今後の課題}
\label{ss:END_future}

今後の課題に対する及第点は以下が挙げられる．
\begin{itemize}
  \item 勾配の激しい評価関数に対する局所探索性能を向上させるため，探索が進むにつれて徐々に探索速度を落とし，局所解へ近づく必要がある．
  \item 発見した最適解及び局所解の保持が挙げられる．一度発見した解よりも評価値の高い解を発見してしまった場合，現在保持している解を手放してしまうため，探索範囲の制限及びその周辺個体の位置情報を共有する必要がある．
  \item 個体が同じ最適解及び局所解に収束させないために改良しなければならない．これは個体の密度等によって探索方法を切り替える必要がある．
\end{itemize}
% 今後の課題及び改善点は次の通りである.
% \begin{itemize}
% \item ニューラルネットワークでの圧縮が困難な問題において, \proposed はDCAの初期値によって学習性能が依存し, 学習できたりできなかったりすることがある(付録\ref{app:11mux_seed}参照). DCAを初期値依存しないような改良をする必要がある. DCAの事前学習などが例として挙げられる.
% \item \proposed はNNとLCSを組み合わせているためただでさえ多いハイパーパラメーターがより多くなり, またそのパラメーターが結果に与える影響が大きい(付録\ref{app:deeper}参照)のに加えて, 適切なパラメーター値を決定する理論が無い.
% 現状試行錯誤や経験による設定しかできず, パラメーター数の削減など今後改良の余地がある.
% \item コンプリートアクションマップを生成するXCSRは, 負例の分類子も生成する必要があり, 行動数が増えた際に必要なリソース(計算コストや分類子数)が多くなってしまう. より少ないリソースで学習が可能なようにコンプリートアクションマップではなくベストアクションマップを作成するよう改良する.
% \item オートエンコーダーでの圧縮空間内ではデータは連続ではないため, その中でのデータの加工が実世界に及ぼす影響を想定することはできず, 理論的な説明ができない. 変分オートエンコーダー(Variable Autoencoder)\cite{VAE}を用いるなど, 圧縮空間内でのデータの加工が意味を持つような改良を加えることで精度や解釈性が向上する見込みがある.
% \item 本論文ではMNIST分類問題とマルチプレクサ問題を題材として取り上げたが, 他の問題に適用しその有効性を広く検証する必要がある.
% \item XCSRは実数値入力に対応しているが, 本論文では離散値の問題でしか検証をしていない. 連続値入力に対する性能検証をする必要がある.
% \item 二点交叉は問題によっては不向きなため, 一様交叉に変更することでGAの効率を上げる.
% \item 本論文の実験では1つの問題として11-マルチプレクサ問題を取り上げ, 学習に成功したが20-マルチプレクサ問題においては学習が上手く行っていない. パラメーターの設定を変えるなどの検討が必要である.
% \end{itemize}


\clearpage
\pagestyle{plain}
\section*{謝辞}
\addcontentsline{toc}{section}{謝辞}
本論文の執筆並びに研究を進める上で御指導頂いた高玉圭樹教授に感謝の意を表します. 
また, 論文執筆において校正・校閲をして頂いた博士課程の高野諒さん,上野史さん，日々の研究テーマに関して助言をして頂いた佐藤寛之准教授, 並びに日々研究を共にしている研究室の皆様, 研究を支えて頂いている皆様にこの場を借りて感謝致します. 

\clearpage
\newpage
\addcontentsline{toc}{section}{参考文献}
\bibliography{./ref/ref}

% \clearpage
% \setcounter{section}{0}
% \setcounter{subsection}{0}
% \section*{付録}
% \addcontentsline{toc}{section}{付録}
% \renewcommand{\thesubsection}{\Alph{subsection}}
% \renewcommand{\thesubsubsection}{\Alph{subsection}-\arabic{subsubsection}}


\end{document}
%
%なお, より深いDCAを用いた\proposed は圧縮ルールの使用/不使用に関係なく表\ref{tab:mpp_classifier}の一番下のような解釈性の高い分類子が獲得できた.
%
%これらの結果より, より深い層のDCAを用いると圧縮ルールを使用しない場合は分類精度が向上し, 圧縮ルールを使用する場合は収束が早くなるため, より深い層のDCAを用いる事は有効であると言える.
